---
title: Predicting the overall popular vote for the next Canadian Federal Election using Socio-economic factors
author:
  - Uzair Mirza
  - Shruti Sood
  - Pranav Sethi
  - Krisha Selvakumar
date: "May 28, 2021"
output:
  pdf_document:
    extra_dependencies: ["float"]
    latex_engine: xelatex
subtitle: STA304 - Group-4 Assignment 2 
---
![](/Users/ujji7/Desktop/cover page image.png)

\newpage

```{r, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
#library(openintro)
library(tidyverse)
library(broom)
library(ggpubr)
library(lme4)
library(survey)
library(DiagrammeR)
library(webshot)
```

```{r, echo = FALSE}
# Here you can load in the census data 
census_data <- read_csv("gss_clean.csv")
# Here you can load in the survey data
survey_data <- read_csv("ces2019_clean.csv")
```

# Introduction
## Goal
Canada has always been a vibrant democracy which is solely for the people, of the people and by the people. Canada’s Egalitarian approach to Democracy has particularly made sure that during any form of decision making in the government at any level, the above statement is given the utmost importance. At the heart of Canadian Democracy, Canadian decision making lies in the Federal election during which a general vote is held to elect the people who will make decisions for Canada’s future: the members of Parliament. Under the Canadian law, the federal elections are scheduled every four years during which election races are held in electoral districts to represent the people living in that area. There are a total of 338 electoral districts with the most being present in Ontario. \
The goal of this study will be to predict the overall popular vote of the next Federal elections which are scheduled to take place on or before October 16 2023. This was done using regression models with post-stratification, both of which will be described in depth in later sections. The models were built using the Canadian Election Study of 2019 which was treated as Survey Data, and predictions were performed using General Social Survey from 2017 which was treated as census data. \


## Background
The first Canadian federal election was held in 1867, and after Bill C-16 was proclaimed into the law, federal elections have been regularly occurring every four years in most provinces**[1][2]**. Elections Canada hires nearly 250,000 people all over Canada during the federal elections making it the largest employer in Canada on election day **[3]**. \


## Hypothesis
For the past three federal elections that were held in Canada, the top three parties have been Liberal, Conservative and New Democratic Party where the Liberal Party had the most popular vote for the last two elections **[4]**.Naturally one would be curious about the future election that is to take place in 2023 as the party with the most popular vote will be ruling our country for the next couple of years. This leads to our analysis of forecasting the popular vote for the upcoming federal election and we are expecting the overall popular vote to be Liberal based on patterns from the past election results.**[4]**. \


## Significance
As touched upon earlier, the federal election lies at the heart of Canadian democracy and decision making. Once the votes are counted Canadians learn who their government will be**[5]**.
Being such an important event for all residents of Canada and also to people outside Canada to a certain degree, it is of prime importance to have quality research done on the federal elections for the continued  functioning of a healthy democracy. Research done on federal elections can not only reveal existing traits about the political preferences, but also future political preferences of Canadians, which is what this study is aimed at answering. Results of this study can be used by political parties to get an estimate of their standing in the future to plan upcoming campaigns and Canadians can use this study to get a greater understanding of the popular political parties. \


## Global Significance 
In 2017, 96 out of 167 (57%) of countries in the world with populations of 500,000 or more were democracies of some kind. Since the mid-1970’s, the world has seen an increase in the number of countries becoming democratic.**[6]** \
Elections are one of the most important parts of a democratic state. In today’s world, a direct-democracy where all political decisions are made by all the citizens of the country is impractical. Hence, democracy is conducted through representatives. These representatives are nominated through elections during which the citizens choose their leaders and hold them accountable for their performance in the office. Elections give the citizens an opportunity to have a say and express their opinions and feel a sense of belonging to a community and work for its betterment. Every vote is important. Credible Elections indirectly lead to a feeling of personal fulfillment in the citizens. Thus, the findings of this study can not only be studied in Canada but also in electoral democracies throughout the world to get a sense of understanding of the pros & cons of their own electoral system when compared to the Canadian electoral system. For instance, the findings of this study can be used by political analysts in the United States of America, which has historically been a two party system, to understand the effects a multiparty system has on the distribution of votes**[7]**. \

## Terminology for the study
Regression is used to determine the relationship between variables. More specifically, it is used to analyze how certain explanatory variables influence a predictor variable. In our analysis, we will be using logistic regression as this statistical method is used when the predictor is a binary variable and in our case we are building multiple models to predict whether or not an individual will vote for a specific party or not in an effort to use these results to forecast the popular vote in the next federal election. \
Post stratification is a process that involves grouping units with similar characteristics into bins and adjusting the weights of these bins as necessary in order to compare survey results to a census data or any other data set that already exists. We will be performing this method on the Canadian Election Study of 2019 data which will act as our survey results and compare it to the General Social Survey from 2017 data which will be used as our census data.


## Drawbacks
The biggest potential drawback that needs to be considered is the use of data from 2017 & 2019 to predict the outcome of the 2023 federal election. This drawback will most likely have an even greater effect on the findings due to the fact that the data was collected a year before the start of Covid-19 pandemic which has caused unprecedented changes in government policies and spending that has had a significant impact on the political views of Canadians. Apart from that, another potential drawback could be false answers being put by the participants of the survey for the geography and demographic characteristics part of the survey which did not get detected during data cleaning because of them following the correct format but not being the accurate answer for that respective participant. \


# Data
## Dataset description
As mentioned in the Intro, the models were built using the Canadian Election Study of 2019 which was treated as Survey Data, and predictions were performed using General Social Survey from 2017 which was treated as census data. The Canadian election study since 1965 has been a rich source of data on Canadians’ political behavior and attitude. The 2019 iteration of the CES was conducted online with the target population being all Canadian citizens and permanent residents who are 18 years or older. **[8]** An online sample of the participants to be contacted was created from the members of Canadian general population using qualtrics, a survey software tool, with targets stratified by region which were 7 in total. Additionally, within each region, provincial quotas were split evenly. Lastly, the online sample was created with the several aims such as having a 50-50 male & female ratio, 80-20 French & English ratio in Quebec. \
The GSS program established in 1985 has been a rich source of data for monitoring changes in living conditions and providing information on social policy issues in Canada. The 2017 iteration of the GSS was conducted through the phone via computer assisted telephone interviews (CATI) with the target population being all people 15 years or older in Canada excluding residents of Yukon, Northwest Territories, Nunavut, and full-time residents of institutions. Each of the 10 Provinces were divided into strata using geographic areas and the survey frame was created using 2 elements: the list of telephone numbers in use that are available to Statistics Canada, and the address register which contained a list of all dwellings in each of the Provinces. Next, a simple random sample without replacement of records was performed in each stratum to select the household to be contacted.
**[9]**. \

## Data manipulation and cleaning
The journey of Data cleaning started by reducing the number of columns in GSS from 50 to 7 to only include the ones that are needed for the model building. These variables of interest are discussed in the section “description of important variables” which is right below. The reduction of columns was achieved through using the select() function. 
Next, it was decided to merge \
 column # 3: place_birth_macro_region which contained birthplace regions of participants born outside Canada \
 column # 4: place_birth_province which contained the Province the participants were born in. \
The decision to merge these columns was made to reduce the number of parameters for our model and the ease of the reader as both the columns essentially reveal the same characteristic about the participant and each row for these columns had an “NA” whenever the other column didn’t have an “NA”. All the Inputs for both these columns were merged and inserted in a new column labeled place_birth. The inputs for these columns were merged using the coalesce() function and the new column was created using the mutate() function over the coalesce function i.e. mutate(coalesce()) Naturally, column # 3 and # 4 were then deleted using the select() function. \
Lastly, all the NAs' were then dropped from our modified GSS using the na.omit() function.


## Dataset Syncing
Since two different surveys were being used for the study, syncing had to be performed between the GSS and the CES data set to move forward. The syncing process began with re-categorizing answers from the column containing the education level of the participant in our modified GSS so that it matched the categories of the column containing the level of education of the participant in the CES data set. This was done using the replace() function. Next, all the decimal points from age in our modified GSS were dropped to match the format of age in CES. This was done through inserting the column containing age inside the floor() function. Lastly, all the columns in our modified GSS for which we couldn’t find equivalent columns in CES were dropped using the select() function. \

```{r, Data cleaning, echo = FALSE}
#filtering out the required columns
census_data.1 <- select(census_data, 2,12,16,17,19,28,47)

# adding the place of birth to our data set
census_data.2 <- census_data.1 %>% mutate(place_birth = coalesce(place_birth_macro_region, place_birth_province ))
#[https://stackoverflow.com/questions/14563531/combine-column-to-remove-nas]

# removing the columns for place of birth
census_data.3 <- select(census_data.2, -3,-4)

# removing the NA
census_data.4 <- na.omit(census_data.3)
```

```{r, Syncing data, echo = FALSE}
## EDUCATION

# combining the "Trade certificate or diploma" +"College, CEGEP or other non-university certificate or di..."
# into "College, CEGEP, trade certificate or other non-university certificate or di..."
# reason: to sync with the survey data category
census_data.4$education <- replace(census_data.4$education, census_data.4$education ==
                                     "College, CEGEP or other non-university certificate or di...",
                                   "College, CEGEP, trade certificate or other non-university certificate or di...")
census_data.4$education <- replace(census_data.4$education, census_data.4$education ==
                                     "Trade certificate or diploma", "College, CEGEP, trade certificate or other non-university certificate or di...")

## Age
# We drop the decimal point to stay consistent with the survey
census_data.4$age <- floor(census_data.4$age)
```

## Description of Important Variables
As previously mentioned, we will be using the survey data to predict the popular vote among the country based on the individuals that are present in the census data. To conduct our analysis, we need to ensure that the variables in both the survey and census were in the same manner for obvious reasons. Initially we had begun with 81 variables in the data, however after narrowing down the variables we ended up giving importance to 6 main variables which include sex, province, education, political preference, family’s income and age. \
Once again, our goal is to forecast the outcome of the next federal election by using political preference and province as our response variables which are two very important variables as it would be extremely challenging and nearly impossible to conduct a realistic analysis without knowing these details. \
Ekos Research Associates is a Canadian research company that measured males are almost equally inclined to vote for Liberal as they are for Conservatives **[10]**. More specifically, 37% of males have intended to vote for Conservatives and 35% had intentions to vote Liberal **[10]**. This is to say that if the voting population consisted of just Males there would be a tie between the Liberal and Conservatives. On the other hand, Ekos reported that 47% of females were in favor of Liberals and only 23% were in favor of the Conservatives **[10]**. Thus, it can be seen that sex definitely has a huge impact on voting behavior as male and females differ between their political preferences. \
The age of the electoral population matters a great deal as it has been hypothesized that younger people are more likely to vote for liberal in comparison to older people **[11]**. Accordingly, the prediction of the popular vote can be greatly influenced by age depending on the size of the different age groups.
Similarly, the education level of the voters can impact the voter turnout as those with a university degree are 78% likely to vote whereas the voting rate for those with high school education or less is 60% **[12]**. \
Additionally, it has been recorded that families with higher income levels have a greater voter turnout in comparison to those who come from families with a lower income **[13]**. A possible reason for this is due to how costly an activity voting may be as it requires time, information, transportation, and other things that may be inconvenient for lower income families **[13]**. Furthermore, higher income could be associated with higher education and once again this would influence voting results as mentioned previously **[13]**. \

**TABLE**

## Data Drawbacks                 ---COME BACK TO IT__ 
Some of the issues we can see in the data are that the gender does not have the same category as the other data set. Also, we feel there is not enough data from each region, and some of the assumptions we made may affect our results. 

##SHOW THE NUMBER FOR EACH province##
```{r, Data Analysis, fig.height=60, fig.width=40, echo = FALSE}

mytable.1 <- table(survey_data$sex)
lbls.1 <- paste(names(mytable.1), "\n", mytable.1, sep="")

mytable.2 <- table(census_data$sex)
lbls.2 <- paste(names(mytable.2), "\n", mytable.2, sep="")

ggarrange(
ggplot(survey_data, aes(x=sex ))+
  geom_bar(color="darkblue", fill="lightblue", bins = 40) +
  ggtitle("Spread of Sex in Survey") + theme(axis.text=element_text(size=20),
  axis.title=element_text(size=25),plot.title= element_text(size = 30, hjust = 0.5,
  face = "bold")) ,

ggplot(census_data.4, aes(x=sex))+
  geom_bar(color="darkblue", fill="lightblue", bins = 40) +
  ggtitle("Spread of Sex in Census")+ theme(axis.text=element_text(size=20),
  axis.title=element_text(size=25),plot.title= element_text(size = 30, hjust = 0.5,
  face = "bold")),

ggplot(survey_data, aes(x=province ))+
  geom_bar(color="darkblue", fill="lightblue", bins = 40) +
  ggtitle("Spread of Province in Survey")+ theme(axis.text=element_text(size=20),
  axis.title=element_text(size=20),plot.title= element_text(size = 30, hjust = 0.5,
  face = "bold"),axis.text.x = element_text(angle = 90)),

ggplot(census_data.4, aes(x=province))+
  geom_bar(color="darkblue", fill="lightblue", bins = 50) +
  ggtitle("Spread of Province in Census")+ theme(axis.text=element_text(size=20),
  axis.title=element_text(size=20),plot.title= element_text(size = 30, hjust = 0.5,
  face = "bold"),axis.text.x = element_text(angle = 90)),

ggplot(survey_data, aes(x=age ))+
  geom_histogram(color="darkblue", fill="lightblue", bins = 40) +
  ggtitle("Spread of Ages in Survey")+ theme(axis.text=element_text(size=20),
  axis.title=element_text(size=25),plot.title= element_text(size = 30, hjust = 0.5,
  face = "bold")),

ggplot(census_data.4, aes(x=age))+
  geom_histogram(color="darkblue", fill="lightblue", bins = 50) +
  ggtitle("Spread of Ages in Census")+ theme(axis.text=element_text(size=20),
  axis.title=element_text(size=25),plot.title= element_text(size = 30, hjust = 0.5,
  face = "bold")),

ggplot(survey_data, aes(x=income_family ))+
  geom_bar(color="darkblue", fill="lightblue", bins = 40) +
  ggtitle("Spread of Family's incomes in Survey")+ theme(axis.text=element_text(size=20),
  axis.title=element_text(size=25),plot.title= element_text(size = 30, hjust = 0.5,
  face = "bold")),

ggplot(census_data.4, aes(x=income_family))+
  geom_bar(color="darkblue", fill="lightblue", bins = 50) +
  ggtitle("Spread of Family's incomes in Census")+ theme(axis.text=element_text(size=20),
  axis.title=element_text(size=25),plot.title= element_text(size = 30, hjust = 0.5,
  face = "bold")),
 ncol=2, nrow=4)

# get the frequency for each variable using 
table(census_data.4$province)
```

## Plot Description
**Bar Chart 1:** Spread of Sex in Survey
There is a greater percentage of Male voters in the electoral population of the survey data. More precisely, around 63% of the population consists of Male voters.

**Bar Chart 2:** Spread of Sex in Census
Unlike the survey data, the electoral population in the census data consists of more females than males as roughly 46%  of the population consists of Male voters.

**Bar Chart 3:** Spread of Province in Survey:
The bar chart shows the current province the voters of the survey data reside in. The top three provinces that make up the electoral population are British Columbia, Ontario and Quebec as there are over 200 voters from each of these provinces which cover around 61% of the population. Meanwhile, 11% of the population consists of voters in New Brunswick, Newfoundland Labrador and Prince Edward Island with just under 50 voters from each of these provinces. The remaining 28% of the population resides in Alberta, Manitoba, Nova Scotia and Saskatchewan.

**Bar Chart 4:** Spread of Province in Census
Similar to  the bar chart about the spread of provinces in the survey, most of the population resides in British Columbia, Ontario and Quebec. More exactly, roughly 58% of the voters belong to these provinces. Unlike the survey data which had 20% of voters from British Columbia, the census data records only 12% of voters from this province. Manitoba,New Brunswick, Newfoundland and Labrador, Nova Scotia, and Saskatchewan all have 1000 to 1400 individuals from their province. Least amount of voters are from Prince Edward Island as expected since it is the smallest province in Canada.\

**Histogram 1:** Spread of Ages in Survey
The data spread closely represents a normal histogram. The mean is around 50 years. A very small amount of the old people (people over the age of 80) vote.\

**Histogram 2:** Spread of Ages in Census
This histogram is close to a left skewed distribution. Surprisingly, unlike the Spread of the ages in Survey, the max amount of the voters were from the older ager group (80 years old). 

**Histogram 3:** Spread of Family's incomes in Survey
This histogram is close to a left skewed distribution. (FIX GRAPH). In this data, the majority of the population belongs to the $125,000 and more group. The other groups are almost ⅓ of the number of people in this group.

**Histogram 4:** Spread of Family's incomes in Census
This histogram is close to a right skewed distribution. FIX GRAPH. In the census data too, the maximum amount of the voters have an income of $125,000 and above. All other groups are decreasing, but there is not as much of a difference as there was in the previous graph.


# Methods
## Model Choice and Setup
The goal is to make the prediction for the upcoming election. There are a lot of factors which effect someone's voting preference such as their area of residence, their place of birth, income levels, age, sex and many more. \
Now in order to account for and see how all these factors effect someone's decision in choosing a party to vote for we will be using **Regression**. Regression is a statistical technique which measures the relationship as to how the changes in different quantities(independent variable) effect the quantity of interest(dependent variable). \
In Canada the party which forms the government is the party which wins majority of the 338 available seats. These sectors are divided and belong to different provinces, the distribution of these seats across the provinces are as follows**[16]**:

```{=latex}
\begin{table}[ht]
\caption{Seat distribution across provinces} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
province & Seats \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
British Columbia & 42 \\ % inserting body of the table
Alberta & 34 \\
Saskatchewan & 14 \\
Manitoba & 14 \\
Ontario & 121 \\
Quebec & 78 \\
New Brunswick & 10 \\
Nova Scotia & 11 \\
Prince Edward Island & 4 \\
Newfoundland and Labrador & 7 \\
Ontario & 121 \\
Yukon & 1 \\
Northwest Territories & 1 \\
Nunavut & 1 \\ \hline
Total & 338 \\[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```
Based on this table we can see how the distribution of the seats is not even across the provinces, hence we need to account for this. Furthermore another thing to note is how political preference has a really high correlation with which province a person belongs to.**[14]** \
Having established how the distribution of seats are not even and how the voting preference differs across the provinces, to account for this we will be running our regression models for each province to get better results.\
Another thing to note is that within each province voting preference shifts across different income levels **[15]**. To account for this we will be using **Multilevel Regression**. Multilevel regression differs from normal regression on the way that in normal regression not accounting for the different levels which effect our data would have an offset in our regression line. The intercept of the line needs to be adjusted to account for the different levels. **NOTE** here in our case "level" refers to the groups within each province, which is ***family income level*** which we expect to have similar effects on the variable of interest. \
Lastly another important aspect about the past elections has been that they have been dominated by particular parties. These political parties also happen to dominate and have majority number of seats in each province, hence estimating and predicting whether they win their particular provinces will acts as an estimate as to whether they will win the general election and form the government**[17]**.\
To make this estimate we are going to hypothesize and setup our model using the *survey data* and train it to estimate whether someone **will be voting for a particular party or not**. To do this we will be using **Multilevel Logistic Regression**, logistic regression is used when we are dealing with a **binary response variable**. \

## Post stratatification and Estimation
Now in our case we will be first divide our **CENSUS DATA** for each province then then into different **bins**. The concept of bins here is based on grouping the data into different groups and these are the variables which are present in our regression model.
Now running this data set on the generated model for each popular party in each province will generate **log odds** of the particular group voting in favor of our hypothesized party. \

Now in general the log odds generated from the regression model will look like:
 $$\log(\frac{\hat p_{h_{0}}}{1- \hat p_{h_{0}}}) = \beta_{0} + \beta_{1}x_{1} + \beta_{2}x_{2} + ... + \beta_{k}x_{k} \qquad i \subset [1,k]$$ 
Here $\beta_{0}$ is the measure for the level is random intercept which accounts for the different income levels and $\beta_{i}, i \subset[1,k] $ are the other factors which effect our model. \

Although as previously mentioned that there are many variables which effect someone's voting preference but due to the limitation of data we will be dividing our data set in different provinces and then for each province we will be making our model on **family income level**, **sex**, **education level** and **age group**. So the resulting $\beta_{i}$ will be the following:
```{=latex}
\begin{table}[ht]
\caption{$\beta_{i}$ and the corresponding measure} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
$\beta_{i}$ & Variable  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
$\beta_{0}$ & Family income-level \\ % inserting body of the table
$\beta_{1}$ & Sex \\
$\beta_{2}$ & Education level \\
$\beta_{3}$ & Age group \\[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```

### From log Odds to Estimating Probability
Now after generating the model and running the model on our test data to get the log odds we would need to extract the probability of that particular person voting for in favour of the party. To do this we would need to follow these 4 steps: \
**STEP 1:**
$$\log(\frac{\hat p_{h_{0}}}{1- \hat p_{h_{0}}}) = \beta_{0} + \Sigma^{k}_{i = 1} \beta_{i}x_{i} \quad{} \Longrightarrow \frac{\hat p_{h_{0}}}{1- \hat p_{h_{0}}} =  \exp({\beta_{0} + \Sigma^{k}_{i = 1} \beta_{i}x_{i})}$$
**STEP 2:**
$$\hat p_{h_{0}} = (1 - \hat p_{h_{0}})( \exp{(\beta_{0} +\Sigma^{k}_{i = 1} \beta_{i}x_{i}})) \quad{} \Longrightarrow \hat p_{h_{0}} = ( \exp{(\beta_{0} +\Sigma^{k}_{i = 1} \beta_{i}x_{i}})) - \hat p_{h_{0}} (\exp{(\beta_{0} + \Sigma^{k}_{i = 1} \beta_{i}x_{i}}))$$
**STEP 3:**
$$\hat p_{h_{0}} +  \hat p_{h_{0}} (\exp{(\beta_{0} + \Sigma^{k}_{i = 1} \beta_{i}x_{i}}))  = \exp(\beta_{0} +{\Sigma^{k}_{i = 1} \beta_{i}x_{i}}) \quad{} \Longrightarrow \hat p_{h_{0}} (1+(\exp{(\beta_{0} + \Sigma^{k}_{i = 1} \beta_{i}x_{i}})) = \exp{(\beta_{0}+\Sigma^{k}_{i = 1} \beta_{i}x_{i}})$$
**STEP 4:**
$$\hat p_{h_{0}} (1+(\exp{(\beta_{0} + \Sigma^{k}_{i = 1} \beta_{i}x_{i}})) = \exp{(\beta_{0}+\Sigma^{k}_{i = 1} \beta_{i}x_{i}}) \quad \Longrightarrow \hat p_{h_{0}} = \frac{\exp{(\beta_{0}+\Sigma^{k}_{i = 1} \beta_{i}x_{i}})}{(1+  (\exp{(\beta_{0}+\Sigma^{k}_{i = 1} \beta_{i}x_{i}}))}$$
**So we have:**
$$\hat p_{h_{0}} = \frac{\exp{(\beta_{0}+\Sigma^{k}_{i = 1} \beta_{i}x_{i}})}{(1+  (\exp{(\beta_{0}+\Sigma^{k}_{i = 1} \beta_{i}x_{i}}))}$$
### Getting the final results **Post Stratification**
Now note by grouping the data, some bins might have a higher weight that it more number of entries compared to the other bins. Hence we need to account for this, we do this using this general formula:
$$\hat y^{PS} = \frac{\Sigma_{i =1}^{n}N_{i}\hat{y_{i}}}{\Sigma_{i =1}^{n}N_{i}} \quad n \subset[2,k],\quad \hat y^{PS}, \hat y_{i} \subset [0,1] $$
Here $\hat y^{PS}$ in our case would be the **expected probability** of the total province sample voting in favor of the political party being tested now. $N_{i}$ is the size of the bin and $\hat{y_{i}}$ is the probability assigned to the bin, this is the same as $\hat p_{h_{0}}$ when calculating teh probability for bins instead of individuals. Finally $k$ is the number of bins generated in our sample data.\
Note the reason for the assumption for $n \subset [2,k]$ is because we assume there to be more than 1 different group as without that condition, usisng this techinique is of not much significance.

# Results
As mentioned we are generating results for every province, so here we need to first outline the popular political parties in each province.
Here is a table of the popular parties in each province[]:
```{=latex}
\begin{table}[ht]
\caption{Popular political parties} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
province & Seats \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line

        & NDP (New Democratic Party, New Democrats, NDPers)  \\ % inserting body of the table
Alberta & Conservatives (Tory, PCs, Conservative Party of Canada)  \\
        & Liberal (Grits) \\ \hline
        
                 & NDP (New Democratic Party, New Democrats, NDPers) \\
British Columbia & Conservatives (Tory, PCs, Conservative Party of Canada) \\
                 & Liberal (Grits) \\ \hline
                 
        & NDP (New Democratic Party, New Democrats, NDPers) \\
Ontario & Conservatives (Tory, PCs, Conservative Party of Canada) \\
        & Liberal (Grits) \\
        
         & NDP (New Democratic Party, New Democrats, NDPers) \\ \hline
Manitoba & Conservatives (Tory, PCs, Conservative Party of Canada) \\
         & Liberal (Grits) \\ \hline
         
        & (Coalition Avenir Québec or the CAQ)* \\ 
Quebec  & (Quebec Liberal Party)* \\
        & Bloc Québécois (BQ, PQ, Bloc, Parti Québéc \\ \hline
    
              & Conservatives (Tory, PCs, Conservative Party of Canada) \\ 
New Brunswick & Liberal (Grits) \\
              & NDP (New Democratic Party, New Democrats, NDPers) \\ \hline
              
              & Conservatives (Tory, PCs, Conservative Party of Canada) \\ 
Saskatchewan  & Liberal (Grits) \\
              & NDP (New Democratic Party, New Democrats, NDPers) \\ \hline
              
            & Conservatives (Tory, PCs, Conservative Party of Canada) \\ 
Nova Scotia & Liberal (Grits) \\
            & NDP (New Democratic Party, New Democrats, NDPers) \\ \hline
              
              & NDP (New Democratic Party, New Democrats, NDPers) \\ 
New Brunswick & Liberal (Grits) \\
              & Conservatives (Tory, PCs, Conservative Party of Canada) \\ \hline
              
                        & Liberal (Grits) \\
Prince Edward Island    & Conservatives (Tory, PCs, Conservative Party of Canada) \\ \hline 
                        & NDP (New Democratic Party, New Democrats, NDPers) \\ 
               \\[1ex] % [1ex] adds vertical space
 %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```
*Note the given data was not available so we chose the overall popular parties in the region which are Liberals and Conservatives.

\newpage
#### POST STRATIFICATION changes
Note that to make the bins and have a healthy number of people in each bin we ended up grouping people in different age groups instead of leaving them as it is. Hence we ended up with grouping the different ages, the age groups were based on the standard age groups in Canada these are as follows **[18]**:

```{=latex}
\begin{table}[ht]
\caption{Age group and corresponding categoery} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Age group & Categoery  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
People under 18 & Under 18 \\ % inserting body of the table
people between 18 and 24 & 18 to 24 years \\
people between 25 to 44 & 25 to 44 years \\
people between 45 and 64 & 45 to 64 years \\ % inserting body of the table
people over 65 & Over 65 \\[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```

The last thing we did was we had to drop two of our categories which were **feeling_life** and **religion_participation** the reason for doing so was to get a better much more reliable model.

#### R-Functions used in calculating results
Lastly for our study the we used built in R functions for our calculations. To calculate log odds we used **predict(model, data.frame)**, the estimated probability we used a function we made named **est_p** as displayed below. Note the **input** "sum" are the log odds calculated using the predict() function.
```{r, Probility Function}
est_p <- function(sum){
  return(exp(sum)/(1+(exp(sum))))
}
```

And finally the estimate for our hypothesis is done using this following lines of R-code displayed in the code chuck below.
```{r, eval=FALSE}
Output <- data.frame %>% summarise(estimate = (sum(n*probability.bin)/N))
```
Here is a table detailing what everything means for in the above code chunk:
```{=latex}
\begin{table}[ht]
\caption{R-code breakdown} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
R-code & Breakdown  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
$n$                 & Bin size \\ % inserting body of the table
$ probability.bin $   & Probability of the group \\
$N$                 & sum of all bin size  \\
sum(...)          & Sums the "..." within the brackets  \\ % inserting body of the table
summarise(...)    & Generates a summary of the result  \\
$data.frame$        & Data frame containing the Estimated bin probability \\
$Output$            & variable to store the Estimated Probability of Hypothesis   \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```

In summary here are the steps we will be using to calculate our results:
```{r, echo = F, fig.dim= 300}
DiagrammeR::grViz("digraph flowchart {
      # node definitions with substituted label text
      node [fontname = Helvetica, shape = rectangle]        
      tab1 [label = '@@1']
      tab2 [label = '@@2']
      tab3 [label = '@@3']
      tab4 [label = '@@4']
      tab5 [label = '@@5']
      tab6 [label = '@@6']
      tab7 [label = '@@7']
      tab8 [label = '@@8']
      tab9 [label = '@@9']

      # edge definitions with the node IDs
      tab1 -> tab2 -> tab3 -> tab4 -> tab5 -> tab6 -> tab7 -> tab8 -> tab9;
      }

      [1]: 'Divide both the data frames into provences'
      [2]: 'Find popular parties for each province'
      [3]: 'Group the Survey data into people voting in favour/not in favour of the selected party'
      [4]: 'Make the model based on the new survey data'
      [5]: 'Group the census province data into bins'
      [6]: 'Using the model make the predicitons on the data from previous step'
      [7]: 'Get the estimated percentage for the party in the province'
      [8]: 'Party with the highest percentage gets all the seats for that region'
      [9]: 'Part with the most seats is the most popular party and is expected to win'
      ")
```

\newpage

## Results for Alberta
As mentioned earlier the top 3 popular parties in Alberta are **NDP (New Democratic Party, New Democrats, NDPers)**, **Conservatives (Tory, PCs, Conservative Party of Canada)** and **Liberal (Grits)**.
Here are the results for the top 3 parties:
```{=latex}

\begin{table}[ht]
\caption{Popular Political Vote in Alberta} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Political Party & Party's Popularity  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
NDP (New Democratic Party, New Democrats, NDPers)           & 24.95\% \\ % inserting body of the table
\textbf{Conservatives (Tory, PCs, Conservative Party of Canada)}     & \textbf{67.76\%}	 \\
Liberal (Grits)                                             & 12.52\%  \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```


```{r, echo= F}
## make the according data sets according to the Support of their party               ---WITH AGE GROUPS
NDP_predic <- survey_data %>%
  mutate(NDP_pref = case_when(survey_data$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

## Bloc Québécois (BQ, PQ, Bloc, Parti Québécois)
Bloc_predic <- survey_data %>%
  mutate(Bloc_pref = case_when(survey_data$political_pref == "Bloc Québécois (BQ, PQ, Bloc, Parti Québécois)" ~ 1,
                              survey_data$political_pref != "Bloc Québécois (BQ, PQ, Bloc, Parti Québécois)" ~ 0))

## Green Party (Greens)
Green_predic <- survey_data %>%
  mutate(Green_pref = case_when(survey_data$political_pref == "Green Party (Greens)" ~ 1,
                              survey_data$political_pref != "Green Party (Greens)"  ~ 0))

## Conservatives (Tory, PCs, Conservative Party of Canada)
Conservative_predic <- survey_data %>%
  mutate(Conservative_pref = case_when(survey_data$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)"  ~ 0))

## Liberal (Grits)
Liberal_predic <- survey_data %>%
  mutate(Liberal_pref = case_when(survey_data$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data$political_pref != "Liberal (Grits)"  ~ 0))

## People's Party
Liberal_predic <- survey_data %>%
  mutate(People_pref = case_when(survey_data$political_pref == "People's Party" ~ 1,
                              survey_data$political_pref != "People's Party"  ~ 0))

## Will spoil ballet
Spoil_pred <- survey_data %>%
  mutate(People_pref = case_when(survey_data$political_pref == "Will spoil ballet" ~ 1,
                              survey_data$political_pref != "Will spoil ballet"  ~ 0))

## Other
Other_pred <- survey_data %>%
  mutate(Other_pref = case_when(survey_data$political_pref == "Other" ~ 1,
                              survey_data$political_pref != "Other"  ~ 0))
```

```{r, echo=FALSE}
#removing people less than 18 to match with                                ---Move to data cleaning--- **Limitation**
 census_data.44 <- subset(census_data.4, age >18)
  #census_data.4[census_data.4$age > 18, ]

# age group for census data                                                --- Model limitation for bins-----
census_data.5 <- census_data.44 %>%
 mutate(age_group = case_when(census_data.44$age <18 ~ "Under 18",
                              census_data.44$age <25 ~ "18 to 24 years",
                              census_data.44$age <45 ~ "25 to 44 years",
                              census_data.44$age <65 ~ "45 to 64 years",
                              census_data.44$age >64 ~ "Over 65",
                              ))
# dropping place of birth and their age                                   
census_data.6 <- select(census_data.5, -6, -1)

# survey data grouping based on age                                     ---Model Limitation----                             
survey_data.1 <- survey_data %>%
 mutate(age_group = case_when(survey_data$age <18 ~ "Under 18",
                              survey_data$age <25 ~ "18 to 24 years",
                              survey_data$age <45 ~ "25 to 44 years",
                              survey_data$age <65 ~ "45 to 64 years",
                              survey_data$age >64 ~ "Over 65",
                              ))

# removing feeling life, religion participation, age                     --- CHECK maybe a better model---
survey_data.2 <- select(survey_data.1, -3, -6)
survey_data.2 <- select(survey_data.2, -5)


# prob function                           --add this in the model---
est_p <- function(sum){
  return(exp(sum)/(1+(exp(sum))))
}
```

```{r, echo=FALSE}
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the province filter out Alberta people       --Filtering out the NDP survey data for the province to make model
AlbertaXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Alberta",] 
# make the model for predicting the results on Alberta,              
glm_NDP_model.2<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=AlbertaXsurveyXNDP, family=binomial)
#results
#summary(glm_NDP_model.2)

## assign bins and get the counts for the census data

# filter out for Alberta in the census data
albertaXcensus <- census_data.5[census_data.5$province =="Alberta",]
# get the bin count corresponding to the model we make
albertaXcensus.1 <- albertaXcensus %>%
  count(sex, education,  income_family, age_group)

# make the log odds for the regression model
X <- predict(glm_NDP_model.2, albertaXcensus.1)
#view(X)
# appending the log odds to the  NDPxAlberta
albertaXcensus.1$NDP_odds <- X
# getting the probability for each group 
albertaXcensus.1 <- albertaXcensus.1 %>% mutate(prob_NDP = est_p(NDP_odds))

## post-stratification for the albertaX_NDP

## sum of N                             --- add this in the model---
N <- sum(albertaXcensus.1$n)
# prediction for NDPxAlberta
NDP_Vote_percen_Alberta <- albertaXcensus.1 %>% summarise(NDP_est_Alberta = (sum(n*prob_NDP)/N))
NDP_Vote_percen_Alberta    #<- actual results
```

##ConservativesXAlberta
```{r, warning=FALSE, echo=F}
## Making the model and the predictions

# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Alberta
# group the survey data by the province filter out Alberta people       --Filtering out the NDP survey data for the province to make model
AlbertaXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Alberta",] 
# make the model for predicting the results on Alberta,              
glm_Consv_model<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=AlbertaXsurveyXConsv, family=binomial)
#results
#summary(glm_Consv_model)

## now assign bins and make the predictions
# filter out for Alberta in the census data
albertaXcensus <- census_data.5[census_data.5$province == "Alberta",]    #### Can remove this line##
# get the bin count corresponding to the model we make
albertaXcensus.1 <- albertaXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Consv_model, albertaXcensus.1)
#view(X)
# appending the log odds to the  ConservativexAlberta
albertaXcensus.1$Consv_odds <- X
# getting the probability for each group 
albertaXcensus.1 <- albertaXcensus.1 %>% mutate(prob_Consv = est_p(Consv_odds))

## post-stratification for the albertaX_Consv

## sum of N                             --- add this in the model---
N <- sum(albertaXcensus.1$n)
# prediction for ConservativexAlberta
Consv_Vote_percen_Alberta <- albertaXcensus.1 %>% summarise(Consv_est_Alberta = (sum(n*prob_Consv)/N))
Consv_Vote_percen_Alberta
```

##LiberalXAlberta
```{r, warning=FALSE, echo=F}
## Making the model and the predictions

# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits)" ~ 0))

# filter out based on Alberta
# group the survey data by the province filter out Alberta people       --Filtering out the liberal survey data for the province to make model
AlbertaXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Alberta",] 
# make the model for predicting the results on Alberta,              
glm_Lib_model<-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=AlbertaXsurveyXLib, family=binomial)
#results
#summary(glm_Lib_model)

## now assign bins and make the predictions
# filter out for Alberta in the census data
albertaXcensus <- census_data.5[census_data.5$province == "Alberta",]    #### Can remove this line##
# get the bin count corresponding to the model we make
albertaXcensus.1 <- albertaXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Lib_model, albertaXcensus.1)
#view(X)
# appending the log odds to the  LiberalxAlberta
albertaXcensus.1$Lib_odds <- X
# getting the probability for each group 
albertaXcensus.1 <- albertaXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-stratification for the albertaXLiberal

## sum of N                             --- add this in the model---
N <- sum(albertaXcensus.1$n)
# prediction for LiberalxAlberta
Lib_Vote_percen_Alberta <- albertaXcensus.1 %>% summarise(Lib_est_Alberta = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Alberta
```

#British Columbia 
##NDPxBritish Columbia
```{r, warning=FALSE, echo=F}
# getting the NDP survey data to make the models                            
NDP_predic.2 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the province filter out British Columbia people       --Filtering out the NDP survey data for the province to make model
BcXsurveyXNDP <- NDP_predic.2[NDP_predic.2$province == "British Columbia",]
# make the model for predicting the results on British Columbia,              
glm_NDP_model.1<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=BcXsurveyXNDP, family=binomial)
#results
#summary(glm_NDP_model.1)

## assign bins and get the counts for the census data

# filter out for British Columbia in the census data
BcXcensus <- census_data.5[census_data.5$province == "British Columbia",]
# get the bin count corresponding to the model we make
BcXcensus.1 <- albertaXcensus %>%
  count(sex, education,  income_family, age_group)

# make the log odds for the regression model
X <- predict(glm_NDP_model.1, BcXcensus.1)
#view(X)
# appending the log odds to the  NDPxBritish Columbia
albertaXcensus.1$NDP_odds <- X
# getting the probability for each group 
albertaXcensus.1 <- albertaXcensus.1 %>% mutate(prob_NDP = est_p(NDP_odds))

## post-stratification for the British ColumbiaX_NDP

## sum of N                             --- add this in the model---
N <- sum(BcXcensus.1$n)
# prediction for NDPxBritish Columbia
NDP_Vote_percen_BC <- albertaXcensus.1 %>% summarise(NDP_est_BC = (sum(n*prob_NDP)/N))
NDP_Vote_percen_BC
```

## Results for British Columbia
The top 3 poplar political parties in British Columbia are **Conservatives (Tory, PCs, Conservative Party of Canada)**, **Liberal (Grits)** and **NDP (New Democratic Party, New Democrats, NDPers)**.\
Here are the results for the top 3 parties:

```{=latex}
\begin{table}[ht]
\caption{Popular Political Vote in British Columbia} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Political Party & Party's Popularity  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
NDP (New Democratic Party, New Democrats, NDPers)           & 23.10\% \\ % inserting body of the table
\textbf{Conservatives (Tory, PCs, Conservative Party of Canada)}     & \textbf{27.72\%}	 \\
Liberal (Grits)                                             & 26.75\%  \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```


```{r, warning=FALSE, echo=FALSE}
#Consv X BC
# getting the NDP survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Alberta
# group the survey data by the province filter out British Columbia people       --Filtering out the NDP survey data for the province to make model
BcXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "British Columbia",] 
# make the model for predicting the results on British Columbia,              
glm_Consv_model_Bc<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=BcXsurveyXConsv, family=binomial)
#results
#summary(glm_Consv_model_Bc)

## now assign bins and make the predicitons
# filter out for Alberta in the census data
BcXcensus <- census_data.5[census_data.5$province == "British Columbia",]    #### Can remove this line##
# get the bin count corresponding to the model we make
BcXcensus.1 <- BcXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Consv_model_Bc, BcXcensus.1)
#view(X)
# appending the log odds to the  NDPxBritish Columbia
BcXcensus.1$Consv_odds <- X
# getting the probability for each group 
BcXcensus.1 <- BcXcensus.1 %>% mutate(prob_Consv_Bc = est_p(Consv_odds))

## post-stratification for the albertaX_Consv

## sum of N                             --- add this in the model---
N <- sum(BcXcensus.1$n)
# prediction for NDPxBritish Columbia
Consv_Vote_percen_Bc <- BcXcensus.1 %>% summarise(Consv_est_Bc = (sum(n*prob_Consv_Bc)/N))
Consv_Vote_percen_Bc
```


```{r, warning=FALSE, echo=F}
#LiberalXBritish Columbia
## Making the model and the predictions

# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits)" ~ 0))

# filter out based on BC
# group the survey data by the province filter out Bc people       --Filtering out the Liberal survey data for the province to make model
BcXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "British Columbia",]
# make the model for predicting the results on Alberta,              
glm_Lib_model_Bc <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=BcXsurveyXLib, family=binomial)
#summary(glm_Lib_model_Bc)

## now assign bins and make the predictions
# filter out for Bc in the census data
BcXcensus <- census_data.5[census_data.5$province == "British Columbia",]    #### Can remove this line##
# get the bin count corresponding to the model we make
BcXcensus.1 <- BcXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Lib_model_Bc, BcXcensus.1)
#view(X)
# appending the log odds to the  LiberalxBc
BcXcensus.1$Lib_odds <- X
# getting the probability for each group 
BcXcensus.1 <- BcXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-stratification for the BcX_Consv

## sum of N                             --- add this in the model---
N <- sum(BcXcensus.1$n)
# prediction for LiberalxBc
Lib_Vote_percen_Bc <- BcXcensus.1 %>% summarise(Lib_est_Bc = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Bc
```

## Results for Ontario
The top 3 poplar political parties in Ontario are **Conservatives (Tory, PCs, Conservative Party of Canada)**, **Liberal (Grits)** and **NDP (New Democratic Party, New Democrats, NDPers)**.\
Here are the results for the top 3 parties:
```{=latex}
\begin{table}[ht]
\caption{Popular Political Vote in Ontario} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Political Party & Party's Popularity  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
NDP (New Democratic Party, New Democrats, NDPers)           & 14.77\% \\ % inserting body of the table
\textbf{Conservatives (Tory, PCs, Conservative Party of Canada)}     & \textbf{27.57\%}	 \\
Liberal (Grits)                                             & 26.76\%  \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```

```{r, warning=FALSE, echo = F}
##NDPxOntario
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the province filter out Ontario people       --Filtering out the NDP survey data for the province to make model
OntarioXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Ontario",] 
# make the model for predicting the results on Ontario,              
glm_NDP_model.2<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=OntarioXsurveyXNDP, family=binomial)
#results
#summary(glm_NDP_model.2)

## assign bins and get the counts for the census data

# filter out for Ontario in the census data
ontarioXcensus <- census_data.5[census_data.5$province =="Ontario",]
# get the bin count corresponding to the model we make
ontarioXcensus.1 <- ontarioXcensus %>%
  count(sex, education,  income_family, age_group)

# make the log odds for the regression model
X <- predict(glm_NDP_model.2, ontarioXcensus.1)
#view(X)
# appending the log odds to the  NDPxOntario 
ontarioXcensus.1$NDP_odds <- X
# getting the probability for each group 
ontarioXcensus.1 <- ontarioXcensus.1 %>% mutate(prob_NDP_Ontario = est_p(NDP_odds))

## post-stratification for the OntarioX_NDP

## sum of N                             --- add this in the model---
N <- sum(ontarioXcensus.1$n)
# prediction for NDPxOntario
NDP_Vote_percen_Ontario <- ontarioXcensus.1 %>% summarise(NDP_est_Ontario = (sum(n*prob_NDP_Ontario)/N))
NDP_Vote_percen_Ontario
```


```{r, warning=FALSE, echo=FALSE}
##Conservatives x Ontario
# getting the Conservatives survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Ontario
# group the survey data by the province filter out Ontario people       --Filtering out the NDP survey data for the province to make model
OnXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Ontario",] 
# make the model for predicting the results on Ontario,              
glm_Consv_model_On<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=OnXsurveyXConsv, family=binomial)
#results
#summary(glm_Consv_model_On)

## now assign bins and make the predictions
# filter out for Ontario in the census data
OnXcensus <- census_data.5[census_data.5$province == "Ontario",]    #### Can remove this line##
# get the bin count corresponding to the model we make
OnXcensus.1 <- OnXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Consv_model_Bc, OnXcensus.1)
#view(X)
# appending the log odds to the  ConsxOntario
OnXcensus.1$Consv_odds <- X
# getting the probability for each group 
OnXcensus.1 <- OnXcensus.1 %>% mutate(prob_Consv_On = est_p(Consv_odds))

## post-stratification for the OntarioX_Consv

## sum of N                             --- add this in the model---
N <- sum(OnXcensus.1$n)
# prediction for ConsxOntario
Cons_Vote_percen_Bc <- OnXcensus.1 %>% summarise(Consv_est_On = (sum(n*prob_Consv_On)/N))
Cons_Vote_percen_Bc
```

```{r, warning=FALSE,echo=F}
###Liberal X Ontario
## Making the model and the predictions

# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on Ontario
# group the survey data by the province filter out Ontario people       --Filtering out the Liberal survey data for the province to make model
OnXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Ontario",]
# make the model for predicting the results on Ontario,              
glm_Lib_model_On <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=OnXsurveyXLib, family=binomial)
#summary(glm_Lib_model_On)

## now assign bins and make the predictions
# filter out for Ontario in the census data
OnXcensus <- census_data.5[census_data.5$province == "Ontario",]    #### Can remove this line##
# get the bin count corresponding to the model we make
OnXcensus.1 <- OnXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Lib_model_Bc, OnXcensus.1)
#view(X)
# appending the log odds to the  LiberalxOntario
OnXcensus.1$Lib_odds <- X
# getting the probability for each group 
OnXcensus.1 <- OnXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-stratification for the OntarioX_Lib

## sum of N                             --- add this in the model---
N <- sum(OnXcensus.1$n)
# prediction for LiberalxOntario
Lib_Vote_percen_On <- OnXcensus.1 %>% summarise(Lib_est_On = (sum(n*prob_Lib)/N))
Lib_Vote_percen_On
```
## Results for Manitoba
The top 3 poplar political parties in Ontario are **Conservatives (Tory, PCs, Conservative Party of Canada)**, **Liberal (Grits)** and **NDP (New Democratic Party, New Democrats, NDPers)**.\
Here are the results for the top 3 parties:
```{=latex}
\begin{table}[ht]
\caption{Popular Political Vote in Manitoba} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Political Party & Party's Popularity  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
NDP (New Democratic Party, New Democrats, NDPers)           & 11.98\% \\ % inserting body of the table
\textbf{Conservatives (Tory, PCs, Conservative Party of Canada)}     & \textbf{31.06\%}	 \\
Liberal (Grits)                                             & 18.26\%  \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```


```{r, warning=FALSE, echo=F}
##NDPxManitoba
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the province filter out Manitoba people       --Filtering out the NDP survey data for the province to make model
MnXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Manitoba",] 
# make the model for predicting the results on Manitoba,              
glm_NDP_model.Mn<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=MnXsurveyXNDP, family=binomial)
#results
#summary(glm_NDP_model.Mn)

## assign bins and get the counts for the census data

# filter out for Manitoba in the census data
MnXcensus <- census_data.5[census_data.5$province =="Manitoba",]
# get the bin count corresponding to the model we make
MnXcensus.1 <- MnXcensus %>%
  count(sex, education,  income_family, age_group)

# make the log odds for the regression model
X <- predict(glm_NDP_model.Mn, MnXcensus.1)
#view(X)
# appending the log odds to the  NDPxManitoba 
MnXcensus.1$NDP_odds <- X
# getting the probability for each group
MnXcensus.1 <- MnXcensus.1 %>% mutate(prob_NDP_Manitoba = est_p(NDP_odds))

## post-stratification for the ManitobaX_NDP

## sum of N                             --- add this in the model---
N <- sum(MnXcensus.1$n)
# prediction for NDPxManitoba
NDP_Vote_percen_Manitoba <- MnXcensus.1 %>% summarise(NDP_est_Manitoba = (sum(n*prob_NDP_Manitoba)/N))
NDP_Vote_percen_Manitoba

##Conservatives x Manitoba
# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Manitoba
# group the survey data by the province filter out Manitoba people       --Filtering out the NDP survey data for the province to make model
MnXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Manitoba",] 
# make the model for predicting the results on Manitoba,              
glm_Consv_model_Mn<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=MnXsurveyXConsv, family=binomial)
#results
#summary(glm_Consv_model_Mn)

## now assign bins and make the predictions
# filter out for Ontario in the census data
MnXcensus <- census_data.5[census_data.5$province == "Manitoba",]    #### Can remove this line##
# get the bin count corresponding to the model we make
MnXcensus.1 <- MnXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Consv_model_Bc, MnXcensus.1)
#view(X)
# appending the log odds to the  ConsxManitoba
MnXcensus.1$Consv_odds <- X
# getting the probability for each group 
MnXcensus.1 <- MnXcensus.1 %>% mutate(prob_Consv_Mn = est_p(Consv_odds))

## post-stratification for the ManitobaX_Consv

## sum of N                             --- add this in the model---
N <- sum(MnXcensus.1$n)
# prediction for ConsXManitoba
Cons_Vote_percen_Mn <- MnXcensus.1 %>% summarise(Consv_est_Mn = (sum(n*prob_Consv_Mn)/N))
Cons_Vote_percen_Mn

##Liberal X Manitoba
## Making the model and the predictions

# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on Manitoba
# group the survey data by the province filter out Manitoba people       --Filtering out the Liberal survey data for the province to make model
MnXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Manitoba",]
# make the model for predicting the results on Manitoba,              
glm_Lib_model_Mn <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=MnXsurveyXLib, family=binomial)
#summary(glm_Lib_model_Mn)

## now assign bins and make the predictions
# filter out for Manitoba in the census data
MnXcensus <- census_data.5[census_data.5$province == "Manitoba",]    #### Can remove this line##
# get the bin count corresponding to the model we make
MnXcensus.1 <- MnXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Lib_model_Mn, MnXcensus.1)
#view(X)
# appending the log odds to the  LiberalxManitoba
MnXcensus.1$Lib_odds <- X
# getting the probability for each group 
MnXcensus.1 <- MnXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-stratification for the ManitobaX_Lib

## sum of N                             --- add this in the model---
N <- sum(MnXcensus.1$n)
# prediction for LibxManitoba
Lib_Vote_percen_Mn <- MnXcensus.1 %>% summarise(Lib_est_Mn = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Mn
```
## Results for Quebec
The top 3 poplar political parties in Ontario are **Coalition Avenir Québec or the CAQ**,**Quebec Liberal Party** and **Bloc Québécois (BQ, PQ, Bloc, Parti Québéc)** but as mentioned due to the limitation of the data we have we choose to go with the next popular parties and the final list of the of the parties as mentioned previously in Table3 are: **Conservatives (Tory, PCs, Conservative Party of Canada)**,  **Liberal (Grits)** & **Bloc Québécois (BQ, PQ, Bloc, Parti Québéc)** and here are the results we found:
```{=latex}
\begin{table}[ht]
\caption{Popular Political Vote in Quebec} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Political Party & Party's Popularity  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
Bloc Québécois (BQ, PQ, Bloc, Parti Québéc)    & 24.48\% \\ % inserting body of the table
Conservatives (Tory, PCs, Conservative Party of Canada)     & 17.04\%	 \\
\textbf{Liberal (Grits)}                                   & \textbf{39.63\%}  \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```

```{r, warning=FALSE, echo=F}
##Bloc Quebecois X Quebec
## Making the model and the predictions

# getting the Bloc Quebecois survey data to make the models                            
Quebecois_predic <- survey_data.2 %>%
  mutate(Qb_pref = case_when(survey_data.2$political_pref == "Bloc Québécois (BQ, PQ, Bloc, Parti Québécois)" ~ 1,
                              survey_data.2$political_pref != "Bloc Québécois (BQ, PQ, Bloc, Parti Québécois)" ~ 0))

# filter out based on Quebec
# group the survey data by the province filter out Quebec people       --Filtering out the Bloc Quebecois survey data for the province to make model
QuXsurveyXQb <- Quebecois_predic[Quebecois_predic$province == "Quebec",]
# make the model for predicting the results on Quebec,              
glm_Qb_model_Qb <-glmer(Qb_pref ~ sex + education + (1|income_family) + age_group, data=QuXsurveyXQb, family=binomial)
#summary(glm_Qb_model_Qb)

## now assign bins and make the predictions
# filter out for Quebec in the census data
QbXcensus <- census_data.5[census_data.5$province == "Quebec",]    #### Can remove this line##
# get the bin count corresponding to the model we make
QbXcensus.1 <- QbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Qb_model_Qb, QbXcensus.1)
#view(X)
# appending the log odds to the  Bloc QuebecoisxQuebec
QbXcensus.1$Qb_odds <- X
# getting the probability for each group 
QbXcensus.1 <- QbXcensus.1 %>% mutate(prob_Qb = est_p(Qb_odds))

## post-stratification for the QuebecX_Qb

## sum of N                             --- add this in the model---
N <- sum(QbXcensus.1$n)
# prediction for QuebecX_Qb
Qb_Vote_percen_Qb <- QbXcensus.1 %>% summarise(Qb_est_Qb = (sum(n*prob_Qb)/N))
Qb_Vote_percen_Qb

##Conservatives X Quebec
# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Quebec
# group the survey data by the province filter out Quebec people       --Filtering out the Conservative survey data for the province to make model
QbXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Quebec",] 
# make the model for predicting the results on Quebec,              
glm_Consv_model_Qb<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=QbXsurveyXConsv, family=binomial)
#results
#summary(glm_Consv_model_Qb)

## now assign bins and make the predictions
# filter out for Ontario in the census data
QbXcensus <- census_data.5[census_data.5$province == "Quebec",]    #### Can remove this line##
# get the bin count corresponding to the model we make
QbXcensus.1 <- QbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Consv_model_Qb, QbXcensus.1)
#view(X)
# appending the log odds 
QbXcensus.1$Consv_odds <- X
# getting the probability for each group 
QbXcensus.1 <- QbXcensus.1 %>% mutate(prob_Consv_Qb = est_p(Consv_odds))

## post-stratification for the QuebecX_Consv

## sum of N                             --- add this in the model---
N <- sum(QbXcensus.1$n)
# prediction for ConsxQuebec
Cons_Vote_percen_Qb <- QbXcensus.1 %>% summarise(Consv_est_Qb = (sum(n*prob_Consv_Qb)/N))
Cons_Vote_percen_Qb

##Liberal X Quebec
## Making the model and the predictions

# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits)" ~ 0))

# filter out based on Quebec
# group the survey data by the province filter out Quebec people       --Filtering out the Liberal survey data for the province to make model
QbXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Quebec",]
# make the model for predicting the results on Quebec,              
glm_Lib_model_Qb <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=QbXsurveyXLib, family=binomial)
#summary(glm_Lib_model_Qb)

## now assign bins and make the predictions
# filter out for Quebec in the census data
QbXcensus <- census_data.5[census_data.5$province == "Quebec",]    #### Can remove this line##
# get the bin count corresponding to the model we make
QbXcensus.1 <- QbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Lib_model_Qb, QbXcensus.1)
#view(X)
# appending the log odds to the  LiberalXQuebec
QbXcensus.1$Lib_odds <- X
# getting the probability for each group 
QbXcensus.1 <- QbXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-stratification for the Quebec_X_Liberal

## sum of N                             --- add this in the model---
N <- sum(QbXcensus.1$n)
# prediction for LiberalxQuebec
Lib_Vote_percen_Qb <- QbXcensus.1 %>% summarise(Lib_est_Qb = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Qb
```


## Results for New Brunswick
The top 3 poplar political parties in New Brunswick are **Conservatives (Tory, PCs, Conservative Party of Canada)**, **Liberal (Grits)** and **Green Party (Greens)**. A thing to mention in making our estimate for this province is that the data we used to make the model for New Brunswick had a issue when it came to the age group, we had no data on the people between 18-24 years so our predictions are also missing the estimates from the people in that age group.\
Here are the results for the top 3 parties:
```{=latex}
\begin{table}[ht]
\caption{Popular Political Vote in New Brunswick} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Political Party & Party's Popularity  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
Green Party (Greens)                                        & 25.52\% \\ % inserting body of the table
\textbf{Conservatives (Tory, PCs, Conservative Party of Canada)}     & \textbf{39.70\%}	 \\
Liberal (Grits)                                    & 22.97\%  \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}

```

                  
```{r, warning=FALSE, echo=F}
##New BrunswickXLiberal 
## Making the model and the predictions
# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on New Brunswick
# group the survey data by the province filter out New Brunswick people       --Filtering out the Liberal survey data for the province to make model
NbXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "New Brunswick",]

# make the model for predicting the results on New Brunswick,              
glm_Lib_model_Nb <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=NbXsurveyXLib, family=binomial)
#summary(glm_Lib_model_Nb)

## now assign bins and make the predictions
# filter out for New Brunswick in the census data
NbXcensus <- census_data.5[census_data.5$province == "New Brunswick",]    #### Can remove this line##
## removing the bin of people less than 18 because not in the survey bin
NbXcensus <- NbXcensus[NbXcensus$age_group != "18 to 24 years",]
# get the bin count corresponding to the model we make
NbXcensus.1 <- NbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Lib_model_Nb, NbXcensus.1)
#view(X)
# appending the log odds to the  LiberalXNb
NbXcensus.1$Lib_odds <- X
# getting the probability for each group 
NbXcensus.1 <- NbXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-stratification for the New Brunswick_X_Liberal

## sum of N                             --- add this in the model---
N <- sum(NbXcensus.1$n)
# prediction for LiberalxNb
Lib_Vote_percen_Nb <- NbXcensus.1 %>% summarise(Lib_est_Nb = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Nb

##New BrunswickXConservative
# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on New Brunswick
# group the survey data by the province filter out New Brunswick people       --Filtering out the Conservative survey data for the province to make model
NbXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "New Brunswick",] 
# make the model for predicting the results on New Brunswick,              
glm_Consv_model_Nb<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=NbXsurveyXConsv, family=binomial)
#results
#summary(glm_Consv_model_Nb)

## now assign bins and make the predictions
# filter out for Nb in the census data
NbXcensus <- census_data.5[census_data.5$province == "New Brunswick",]    #### Can remove this line##
# get the bin count corresponding to the model we make
## removing the bin of people less than 18 because not in the survey bin
NbXcensus <- NbXcensus[NbXcensus$age_group != "18 to 24 years",]
NbXcensus.1 <- NbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Consv_model_Nb, NbXcensus.1)
#view(X)
# appending the log odds 
NbXcensus.1$Consv_odds <- X
# getting the probability for each group 
NbXcensus.1 <- NbXcensus.1 %>% mutate(prob_Consv_Nb = est_p(Consv_odds))

## post-stratification for the New BrunswickX_Consv

## sum of N                             --- add this in the model---
N <- sum(NbXcensus.1$n)
# prediction for ConsxNew Brunswick
Cons_Vote_percen_Nb <- NbXcensus.1 %>% summarise(Consv_est_Nb = (sum(n*prob_Consv_Nb)/N))
Cons_Vote_percen_Nb

##New BrunswickXGreen
# getting the Conservative survey data to make the models                            
Green_predic.1 <- survey_data.2 %>%
  mutate(Green_pref = case_when(survey_data.2$political_pref == "Green Party (Greens)" ~ 1,
                              survey_data.2$political_pref != "Green Party (Greens)" ~ 0))

# filter out based on New Brunswick
# group the survey data by the province filter out New Brunswick people       --Filtering out the Green survey data for the province to make model
NbXsurveyXGreen <- Green_predic.1[Green_predic.1$province == "New Brunswick",] 
# make the model for predicting the results on New Brunswick,              
glm_Green_model_Nb<-glmer(Green_pref ~ sex + education + (1|income_family) + age_group, data=NbXsurveyXGreen, family=binomial)
#results
#summary(glm_Green_model_Nb)

## now assign bins and make the predictions
# filter out for New Brunswick in the census data
NbXcensus <- census_data.5[census_data.5$province == "New Brunswick",]    #### Can remove this line##
# get the bin count corresponding to the model we make
## removing the bin of people less than 18 because not in the survey bin
NbXcensus <- NbXcensus[NbXcensus$age_group != "18 to 24 years",]
NbXcensus.1 <- NbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Green_model_Nb, NbXcensus.1)
#view(X)
# appending the log odds 
NbXcensus.1$Green_odds <- X
# getting the probability for each group 
NbXcensus.1 <- NbXcensus.1 %>% mutate(prob_Green_Nb = est_p(Green_odds))

## post-stratification for the New BrunswickXGreens

## sum of N                             --- add this in the model---
N <- sum(NbXcensus.1$n)
# prediction for GreensxNew Brunswick
Green_Vote_percen_Nb <- NbXcensus.1 %>% summarise(Green_est_Nb = (sum(n*prob_Green_Nb)/N))
Green_Vote_percen_Nb
```

## Results for Saskatchewan
The top 3 poplar political parties in Saskatchewan are **Conservatives (Tory, PCs, Conservative Party of Canada)**, **Liberal (Grits)** and **NDP (New Democratic Party, New Democrats, NDPers)**.\
Here are the results for the top 3 parties:
```{=latex}
\begin{table}[ht]
\caption{Popular Political Vote in Saskatchewan} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Political Party & Party's Popularity  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
NDP (New Democratic Party, New Democrats, NDPers)           & 11.98\% \\ % inserting body of the table
\textbf{Conservatives (Tory, PCs, Conservative Party of Canada)}     & \textbf{61.75\%}	 \\
Liberal (Grits)                                             & 10.16\%  \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```

```{r, warning=FALSE, echo=F}
##Conservative
# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0,))

# filter out based on Saskatchewan
# group the survey data by the province filter out Saskatchewan people       --Filtering out the Conservative survey data for the province to make model
SaXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Saskatchewan",] 
# make the model for predicting the results on Saskatchewan,              
glm_Consv_model_Sa<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=SaXsurveyXConsv, family=binomial)
#results
#summary(glm_Consv_model_Sa)

## now assign bins and make the predictions
# filter out for Saskatchewan in the census data
SaXcensus <- census_data.5[census_data.5$province == "Saskatchewan",]    #### Can remove this line##
# get the bin count corresponding to the model we make
SaXcensus.1 <- SaXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Consv_model_Sa, SaXcensus.1)
#view(X)
# appending the log odds to the  ConservativexSaskatchewan
SaXcensus.1$Consv_odds <- X
# getting the probability for each group 
SaXcensus.1 <- SaXcensus.1 %>% mutate(prob_Consv_Sa = est_p(Consv_odds))

## post-stratification for the Saskatchewan_Consv

## sum of N                             --- add this in the model---
N <- sum(SaXcensus.1$n)
# prediction for ConservativexSaskatchewan
Consv_Vote_percen_Sa <- SaXcensus.1 %>% summarise(Consv_est_Sa = (sum(n*prob_Consv_Sa)/N))
Consv_Vote_percen_Sa

##Liberal
## Making the model and the predictions

# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on Saskatchewan
# group the survey data by the province filter out Saskatchewan people       --Filtering out the Liberal survey data for the province to make model
SaXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Saskatchewan",]
# make the model for predicting the results on Saskatchewan,              
glm_Lib_model_Sa <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=SaXsurveyXLib, family=binomial)
#summary(glm_Lib_model_Sa)

## now assign bins and make the predictions
# filter out for Saskatchewan in the census data
SaXcensus <- census_data.5[census_data.5$province == "Saskatchewan",]    #### Can remove this line##
# get the bin count corresponding to the model we make
SaXcensus.1 <- SaXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Lib_model_Sa, SaXcensus.1)
#view(X)
# appending the log odds to the   LiberalxSaskatchewan
SaXcensus.1$Lib_odds <- X
# getting the probability for each group 
SaXcensus.1 <- SaXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-stratification for the SaskatchewanXLiberal

## sum of N                             --- add this in the model---
N <- sum(SaXcensus.1$n)
# prediction for  LiberalxSaskatchewan
Lib_Vote_percen_Sa <- SaXcensus.1 %>% summarise(Lib_est_Sa = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Sa

# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the province filter out Saskatchewan people       --Filtering out the NDP survey data for the province to make model
SaXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Saskatchewan",] 
# make the model for predicting the results on Saskatchewan,              
glm_NDP_model.Sa<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=SaXsurveyXNDP, family=binomial)
#results
#summary(glm_NDP_model.Sa)

## assign bins and get the counts for the census data

# filter out for Saskatchewan in the census data
SaXcensus <- census_data.5[census_data.5$province =="Saskatchewan",]
# get the bin count corresponding to the model we make
SaXcensus.1 <- SaXcensus %>%
  count(sex, education,  income_family, age_group)

# make the log odds for the regression model
X <- predict(glm_NDP_model.Sa, SaXcensus.1)
#view(X)
# appending the log odds to the  NDPxSaskatchewan 
SaXcensus.1$NDP_odds <- X
# getting the probability for each group
SaXcensus.1 <- SaXcensus.1 %>% mutate(prob_NDP_Manitoba = est_p(NDP_odds))

## post-stratification for the SaskatchewanX_NDP

## sum of N                             --- add this in the model---
N <- sum(SaXcensus.1$n)
# prediction for NDPxSaskatchewan
NDP_Vote_percen_Saskatchewan <- SaXcensus.1 %>% summarise(NDP_est_Saskatchewan = (sum(n*prob_NDP_Manitoba)/N))
NDP_Vote_percen_Saskatchewan
```

## Results for Nova Scotia
The top 3 poplar political parties in Nova Scotia are **Conservatives (Tory, PCs, Conservative Party of Canada)**, **Liberal (Grits)** and **NDP (New Democratic Party, New Democrats, NDPers)**.\
Here are the results for the top 3 parties:
```{=latex}
\begin{table}[ht]
\caption{Popular Political Vote in Nova Scotia} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Political Party & Party's Popularity  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
NDP (New Democratic Party, New Democrats, NDPers)           & 15.59\% \\ % inserting body of the table
\textbf{Conservatives (Tory, PCs, Conservative Party of Canada)}     & \textbf{38.78\%}	 \\
Liberal (Grits)                                             & 34.827\%  \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```


```{r, warning=FALSE, echo=F}
##Conservative
# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Nova Scotia
# group the survey data by the province filter out Nova Scotia people       --Filtering out the Conservative survey data for the province to make model
NsXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Nova Scotia",] 
# make the model for predicting the results on Nova Scotia,              
glm_Consv_model_Ns<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=NsXsurveyXConsv, family=binomial)
#results
#summary(glm_Consv_model_Ns)

## now assign bins and make the predictions
# filter out for Nova Scotia in the census data
NsXcensus <- census_data.5[census_data.5$province == "Nova Scotia",]    #### Can remove this line##
# get the bin count corresponding to the model we make
NsXcensus.1 <- NsXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Consv_model_Ns, NsXcensus.1)
#view(X)
# appending the log odds to the  ConservativexNova Scotia
NsXcensus.1$Consv_odds <- X
# getting the probability for each group 
NsXcensus.1 <- NsXcensus.1 %>% mutate(prob_Consv_Sa = est_p(Consv_odds))

## post-stratification for the Nova ScotiaX_Consv

## sum of N                             --- add this in the model---
N <- sum(SaXcensus.1$n)
# prediction for ConservativexNova Scotia
Consv_Vote_percen_Ns <- NsXcensus.1 %>% summarise(Consv_est_Ns = (sum(n*prob_Consv_Sa)/N))
Consv_Vote_percen_Ns

##Liberal
## Making the model and the predictions

# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits)" ~ 0))

# filter out based on Nova Scotia
# group the survey data by the province filter out Nova Scotia people       --Filtering out the Liberal survey data for the province to make model
NsXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Nova Scotia",]
# make the model for predicting the results on Nova Scotia,              
glm_Lib_model_Ns <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=NsXsurveyXLib, family=binomial)
#summary(glm_Lib_model_Ns)

## now assign bins and make the predictions
# filter out for Nova Scotia in the census data
NsXcensus <- census_data.5[census_data.5$province == "Nova Scotia",]    #### Can remove this line##
# get the bin count corresponding to the model we make
NsXcensus.1 <- NsXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Lib_model_Ns, NsXcensus.1)
#view(X)
# appending the log odds to the  LiberalxNova Scotia
NsXcensus.1$Lib_odds <- X
# getting the probability for each group 
NsXcensus.1 <- NsXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-stratification for the Nova ScotiaXLiberal

## sum of N                             --- add this in the model---
N <- sum(NsXcensus.1$n)
# prediction for LiberalxNova Scotia
Lib_Vote_percen_Ns <- NsXcensus.1 %>% summarise(Lib_est_Ns = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Ns

##NDP
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the province filter out Nova Scotia people       --Filtering out the NDP survey data for the province to make model
NsXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Nova Scotia",] 
# make the model for predicting the results on Nova Scotia,              
glm_NDP_model.Ns<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=NsXsurveyXNDP, family=binomial)
#results
#summary(glm_NDP_model.Ns)

## assign bins and get the counts for the census data

# filter out for Nova Scotia in the census data
NsXcensus <- census_data.5[census_data.5$province =="Nova Scotia",]
# get the bin count corresponding to the model we make
NsXcensus.1 <- NsXcensus %>%
  count(sex, education,  income_family, age_group)

# make the log odds for the regression model
X <- predict(glm_NDP_model.Ns, NsXcensus.1)
#view(X)
# appending the log odds to the  NDPxNova Scotia
NsXcensus.1$NDP_odds <- X
# getting the probability for each group
NsXcensus.1 <- NsXcensus.1 %>% mutate(prob_NDP_Ns = est_p(NDP_odds))

## post-stratification for the Nova ScotiaX_NDP

## sum of N                             --- add this in the model---
N <- sum(NsXcensus.1$n)
# prediction for NDPxNova Scotia
NDP_Vote_percen_Ns <- NsXcensus.1 %>% summarise(NDP_est_Ns = (sum(n*prob_NDP_Ns)/N))
NDP_Vote_percen_Ns
```

## Results for Newfoundland and Labrador
The top 3 poplar political parties in Newfoundland and Labrador are **Conservatives (Tory, PCs, Conservative Party of Canada)**, **Liberal (Grits)** and **NDP (New Democratic Party, New Democrats, NDPers)**. A thing to mention in making our estimate for this province is that the data we used to make the model for Newfoundland and Labrador had a issue when it came to the age group, we had no data on the people between 18-24 years so our predictions are also missing the estimates from the people in that age group. Furthermore due to the limitation of the data size available about Conservatives (Tory, PCs, Conservative Party of Canada) we were unable to make estimation for this party.\
Here are the results for the top 2 parties:
```{=latex}
\begin{table}[ht]
\caption{Popular Political Vote in Newfoundland and Labrador} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Political Party & Party's Popularity  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
\textbf{NDP (New Democratic Party, New Democrats, NDPers) }     & \textbf{38.12\%}	 \\
Liberal (Grits)                                             & 33.71\%  \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```



```{r, warning=FALSE, echo=F}
##NDP
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the province filter out Newfoundland and Labrador people       --Filtering out the NDP survey data for the province to make model
NLXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Newfoundland and Labrador",] 
# make the model for predicting the results on Newfoundland and Labrador,              
glm_NDP_model.NL<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=NLXsurveyXNDP, family=binomial)
#results
#summary(glm_NDP_model.NL)

## assign bins and get the counts for the census data

# filter out for Newfoundland and Labrador in the census data
NLXcensus <- census_data.5[census_data.5$province =="Newfoundland and Labrador",]
## removing the bin of people less than 18 because not in the survey bin
NLXcensus <- NLXcensus[NLXcensus$age_group != "18 to 24 years",]
# get the bin count corresponding to the model we make
NLXcensus.1 <- NLXcensus %>%
  count(sex, education,  income_family, age_group)

# make the log odds for the regression model
X <- predict(glm_NDP_model.NL, NLXcensus.1)
#view(X)
# appending the log odds to the  NDPxNewfoundland and Labrador
NLXcensus.1$NDP_odds <- X
# getting the probability for each group
NLXcensus.1 <- NLXcensus.1 %>% mutate(prob_NDP_NL = est_p(NDP_odds))

## post-stratification for the Newfoundland and LabradorX_NDP

## sum of N                             --- add this in the model---
N <- sum(NLXcensus.1$n)
# prediction for NDPxNewfoundland and Labrador
NDP_Vote_percen_NL <- NLXcensus.1 %>% summarise(NDP_est_NL = (sum(n*prob_NDP_NL)/N))
NDP_Vote_percen_NL

##Liberal
## Making the model and the predictions

# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits)" ~ 0))

# filter out based on Newfoundland and Labrador
# group the survey data by the province filter out Newfoundland and Labrador people       --Filtering out the Liberal survey data for the province to make model
NLXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Newfoundland and Labrador",]
# make the model for predicting the results on Newfoundland and Labrador,              
glm_Lib_model_NL <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=NLXsurveyXLib, family=binomial)
#summary(glm_Lib_model_NL)

## now assign bins and make the predictions
# filter out for Newfoundland and Labrador in the census data
NLXcensus <- census_data.5[census_data.5$province == "Newfoundland and Labrador",]    #### Can remove this line##
## removing the bin of people less than 18 because not in the survey bin
NLXcensus <- NLXcensus[NLXcensus$age_group != "18 to 24 years",]
# get the bin count corresponding to the model we make
NLXcensus.1 <- NLXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Lib_model_NL, NLXcensus.1)
#view(X)
# appending the log odds to the  LiberalxNewfoundland and Labrador
NLXcensus.1$Lib_odds <- X
# getting the probability for each group 
NLXcensus.1 <- NLXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-stratification for the Newfoundland and LabradorX_Consv

## sum of N                             --- add this in the model---
N <- sum(NsXcensus.1$n)
# prediction for NDPxNewfoundland and Labrador
Lib_Vote_percen_NL <- NLXcensus.1 %>% summarise(Lib_est_NL = (sum(n*prob_Lib)/N))
Lib_Vote_percen_NL

##Conservatives
# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Newfoundland and Labrador
# group the survey data by the province filter out Newfoundland and Labrador people       --Filtering out the Conservative survey data for the province to make model
NLXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Newfoundland and Labrador",] 
# make the model for predicting the results on Newfoundland and Labrador,              
glm_Consv_model_NL<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=NLXsurveyXConsv, family=binomial)
#results
#summary(glm_Consv_model_NL)

## now assign bins and make the predictions
# filter out for Newfoundland and Labrador in the census data
NLXcensus <- census_data.5[census_data.5$province == "Newfoundland and Labrador",]    #### Can remove this line##
# get the bin count corresponding to the model we make
## removing the bin of people less than 18 because not in the survey bin
NLXcensus <- NLXcensus[NLXcensus$age_group != "18 to 24 years",]
NLXcensus.1 <- NLXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Consv_model_NL, NLXcensus.1)
#view(X)
# appending the log odds 
NLXcensus.1$Consv_odds <- X
# getting the probability for each group 
NLXcensus.1 <- NLXcensus.1 %>% mutate(prob_Consv_NL = est_p(Consv_odds))

## post-stratification for the Newfoundland and LabradorX_Consv

## sum of N                             --- add this in the model---
N <- sum(NLXcensus.1$n)
# prediction for ConsxNewfoundland and Labrador
Cons_Vote_percen_NL <- NLXcensus.1 %>% summarise(Consv_est_NL = (sum(n*prob_Consv_NL)/N))
 Cons_Vote_percen_NL
```

## Results forPrince Edward Island
The top 3 poplar political parties in Prince Edward Island are **Conservatives (Tory, PCs, Conservative Party of Canada)**, **Liberal (Grits)** and **NDP (New Democratic Party, New Democrats, NDPers)**.\
Here are the results for the top 3 parties:
```{=latex}
\begin{table}[ht]
\caption{Popular Political Vote in Prince Edward Island} % title of Table
\centering % used for centering table
\begin{tabular}{c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Political Party & Party's Popularity  \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
NDP (New Democratic Party, New Democrats, NDPers)           & 9.86\% \\ % inserting body of the table
Conservatives (Tory, PCs, Conservative Party of Canada)     & 20.73163\%	 \\
\textbf{Liberal (Grits)}                                    & \textbf{41.70}\%  \\
[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```


```{r, warning=FALSE, echo=F}
##Conservative
# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Prince Edward Island
# group the survey data by the province filter out Prince Edward Island people       --Filtering out the Conservative survey data for the province to make model
NsXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Prince Edward Island",] 
# make the model for predicting the results on Prince Edward Island,              
glm_Consv_model_Ns<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=NsXsurveyXConsv, family=binomial)
#results
#summary(glm_Consv_model_Ns)

## now assign bins and make the predictions
# filter out for Prince Edward Island in the census data
NsXcensus <- census_data.5[census_data.5$province == "Prince Edward Island",]    #### Can remove this line##
# get the bin count corresponding to the model we make
NsXcensus.1 <- NsXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Consv_model_Ns, NsXcensus.1)
#view(X)
# appending the log odds to the  ConservativexPrince Edward Island
NsXcensus.1$Consv_odds <- X
# getting the probability for each group 
NsXcensus.1 <- NsXcensus.1 %>% mutate(prob_Consv_Sa = est_p(Consv_odds))

## post-stratification for the Prince Edward IslandX_Consv

## sum of N                             --- add this in the model---
N <- sum(SaXcensus.1$n)
# prediction for ConservativexPrince Edward Island
Consv_Vote_percen_Ns <- NsXcensus.1 %>% summarise(Consv_est_PE = (sum(n*prob_Consv_Sa)/N))
Consv_Vote_percen_Ns

##Liberal
## Making the model and the predictions

# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits)" ~ 0))

# filter out based on Prince Edward Island
# group the survey data by the province filter out Prince Edward Island people       --Filtering out the Liberal survey data for the province to make model
NsXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Prince Edward Island",]
# make the model for predicting the results on Prince Edward Island,              
glm_Lib_model_Ns <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=NsXsurveyXLib, family=binomial)
#summary(glm_Lib_model_Ns)

## now assign bins and make the predictions
# filter out for Prince Edward Island in the census data
NsXcensus <- census_data.5[census_data.5$province == "Prince Edward Island",]    #### Can remove this line##
# get the bin count corresponding to the model we make
NsXcensus.1 <- NsXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the log odds for the regression model
X <- predict(glm_Lib_model_Ns, NsXcensus.1)
#view(X)
# appending the log odds to the  LiberalxPrince Edward Island
NsXcensus.1$Lib_odds <- X
# getting the probability for each group 
NsXcensus.1 <- NsXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-stratification for the Prince Edward IslandXLiberal

## sum of N                             --- add this in the model---
N <- sum(NsXcensus.1$n)
# prediction for LiberalxPrince Edward Island
Lib_Vote_percen_Ns <- NsXcensus.1 %>% summarise(Lib_est_PE = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Ns

# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the province filter out Prince Edward Island people       --Filtering out the NDP survey data for the province to make model
NsXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Prince Edward Island",] 
# make the model for predicting the results on Prince Edward Island,              
glm_NDP_model.Ns<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=NsXsurveyXNDP, family=binomial)
#results
#summary(glm_NDP_model.Ns)

## assign bins and get the counts for the census data

# filter out for Prince Edward Island in the census data
NsXcensus <- census_data.5[census_data.5$province =="Prince Edward Island",]
# get the bin count corresponding to the model we make
NsXcensus.1 <- NsXcensus %>%
  count(sex, education,  income_family, age_group)

# make the log odds for the regression model
X <- predict(glm_NDP_model.Ns, NsXcensus.1)
#view(X)
# appending the log odds to the  NDPxPrince Edward Island
NsXcensus.1$NDP_odds <- X
# getting the probability for each group
NsXcensus.1 <- NsXcensus.1 %>% mutate(prob_NDP_Ns = est_p(NDP_odds))

## post-stratification for the Prince Edward IslandX_NDP

## sum of N                             --- add this in the model---
N <- sum(NsXcensus.1$n)
# prediction for NDPxPrince Edward Island
NDP_Vote_percen_Ns <- NsXcensus.1 %>% summarise(NDP_est_PE = (sum(n*prob_NDP_Ns)/N))
NDP_Vote_percen_Ns
```
\newpage
## Summary, comments about results
```{=latex}
\begin{table}[ht]
\caption{Provincial Seats along with Dominant Political Prefrence } % title of Table
\centering % used for centering table
\begin{tabular}{c c c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
Provience & Seats & Dominant Party & Percentage Prefrence \\ [0.5ex] % inserts table
%heading
\hline % inserts single horizontal line
British Columbia            & 42    & Conservatives (Tory, PCs, Conservative Party of Canada)     & 27.72\% \\ % inserting body of the table
Alberta                     & 34    & Conservatives (Tory, PCs, Conservative Party of Canada)     & 67.76\% \\
Saskatchewan                & 14    & Conservatives (Tory, PCs, Conservative Party of Canada)     & 61.75\% \\
Manitoba                    & 14    & Conservatives (Tory, PCs, Conservative Party of Canada)     & 31.06\% \\
Ontario                     & 121   & Conservatives (Tory, PCs, Conservative Party of Canada)     & 27.57\% \\
Quebec                      & 78    & Liberal (Grits)                                             & 39.63\% \\
New Brunswick               & 10    & Conservatives (Tory, PCs, Conservative Party of Canada)     & 39.70\% \\
Nova Scotia                 & 11    & Conservatives (Tory, PCs, Conservative Party of Canada)     & 38.78\% \\
Prince Edward Island        & 4     & Liberal (Grits)                                             & 41.70\% \\
Newfoundland and Labrador   & 7     & NDP (New Democratic Party, New Democrats, NDPers)           & 38.12\% \\
Yukon                       & 1     &   NA                                                        & NA    \\
Northwest Territories       & 1     &   NA                                                        & NA    \\
Nunavut                     & 1     &   NA                                                        & NA    \\ \hline
Most Dominant Party & & Conservatives (Tory, PCs, Conservative Party of Canada) &  \\[1ex] % [1ex] adds vertical space
\hline %inserts single line
\end{tabular}
\label{table:nonlin} % is used to refer this table in the text
\end{table}
```
Based on results displayed in Table 16 we can see that the most popular party on average is the Conservatives (Tory, PCs, Conservative Party of Canada) so we **expect** them to win. However there are still some things we need to take into account, firstly the mostly if we assume that all the people who choose Conservatives as their political preference they would still have about **~94** out the total 338. Note to have a majority a party would need above half of the total available seats which come to 170. \
It is now a good time to also note that in some regions the party that was $2^{nd}$ when it comes to popularity was just behind the party that came $1^{st}$ in that region. Because now if the other party dominates the some other region with a higher seat count with a greater percentage difference then this political party would end having more seats.  This is something we need to consider when making a prediction about the general election and base our results. Furthermore governments are also formed on the basis of independent representatives joining or other parties getting together to form a majority government, note we don't have this information available to us. Lastly as mentioned we had no information about certain groups or about certain political parties to make our model so we were not able to make predictions about those groups or about those parties in our census data. \
In summary however these results seem realistic when compared on a provincial level and also when we compare them to the most recent election from 2019 but there are still much that can be done to get better much more accurate prediction.

```{r, warning=FALSE, eval=F, echo=FALSE}
#Grouping based on provinces
# make them in groups by province
alberta <- census_data.4 %>% group_by(province = "Alberta")
british_columbia <- census_data.4 %>% group_by(province = "British Columbia")
manitoba<- census_data.5 %>% group_by(province = "Manitoba")
new_brunswick<- census_data.5 %>% group_by(province = "New Brunswick")
newfoundland_labrador<- census_data.5 %>% group_by(province = "Newfoundland and Labrador")
nova_scotia<- census_data.5 %>% group_by(province = "Nova Scotia")
ontario <- census_data.5 %>% group_by(province = "Ontario")
prince_edward_island<- survey_data.2 %>% group_by(province = "Prince Edward Island")
quebec<- census_data.5 %>% group_by(province = "Quebec")
saskatchewan<- census_data.5 %>% group_by(province = "Saskatchewan")
```

## Conclusions


## Drawbacks
                                                                      **relevant fields not found in the survey, provinces((11) Northwest Territories, (12) Yukon, (13) Nunavut)**


## Bibliography

1. 1867 Canadian federal election. (n.d.). DBpedia. https://dbpedia.org/page/1867_Canadian_federal_election

2. Bill C-16: An Act to amend the Canada Elections Act. (n.d.). Library Of Parliament. Retrieved May 30, 2021, from https://lop.parl.ca/sites/PublicWebsite/default/en_CA/ResearchPublications/LegislativeSummaries/391LS530E#fprovincial

3.  Did you know? (n.d.). Elections Canada. Retrieved May 30, 2021, from https://www.elections.ca/content.aspx?section=abo&dir=100/kno&document=index&lang=e

4. Canadian Election Results by Party 1867 to 2019. (n.d.). Elections. https://www.sfu.ca/~aheard/elections/1867-present.html

5. Elections Step by Step. (n.d.). Elections Canada. https://electionsanddemocracy.ca/canadas-elections/canadas-election-process/elections-step-step

6. Despite global concerns about democracy, more than half of countries are democratic. (n.d.). Pew Research Center. https://www.pewresearch.org/fact-tank/2019/05/14/more-than-half-of-countries-are-democratic/

7. Functions of elections. (n.d.). Britannica. Retrieved May 30, 2021, from https://www.britannica.com/topic/election-political-science/Functions-of-elections

8. Welcome to the 2019 Canadian Election Study. (n.d.). Canadian Election Study. Retrieved May 30, 2021, from http://www.ces-eec.ca/

9. General Social Survey. (2017, September). https://sda-artsci-utoronto-ca.myaccess.library.utoronto.ca/sdaweb/dli2/gss/gss31/gss31/more_doc/GSS31_User_Guide.pdf

10. Fournier, P. J. (2020, June 28). The biggest divide in Canadian politics? Men vs. Women. Macleans. https://www.macleans.ca/politics/ottawa/the-biggest-divide-in-canadian-politics-men-vs-women/

11. Holland, J. L. (2014, March 7). Age Gap? The Influence of Age on Voting Behavior and Political Preferences in the American Electorate. Washington State University. https://research.libraries.wsu.edu/xmlui/handle/2376/4982

12. Factors associated with voting. (2012, February 24). Statistics Canada. https://www150.statcan.gc.ca/n1/pub/75-001-x/2012001/article/11629-eng.htm

13. Akee, R. (2020, September 24). Voting and Income | Econofact. Econofact | Key Facts and Incisive Analysis to the National Debate on Economic and Social Policies. https://econofact.org/voting-and-income

14. Foladare, I. S. (1986, December). The Effect of Neighborhood on Voting Behavior on JSTOR. JSTOR. https://www.jstor.org/stable/2146812?seq=1

15. H.Y.A.E.M.M. (2014, January 8). The Relationship Between Income Level and Political Preferences for University Academic Staff: The Case of Hakkari. ScienceDirect. https://www.sciencedirect.com/science/article/pii/S1877042813052051

16.House of Commons Seat Allocation by Province – Elections Canada. (n.d.). Elections Canada. Retrieved May 31, 2021, from https://www.elections.ca/content.aspx?section=res&dir=cir/red/allo&document=index&lang=e

17. Wikipedia contributors. (2021, May 24). Politics of Canada. Wikipedia. https://en.wikipedia.org/wiki/Politics_of_Canada#:%7E:text=The%20two%20dominant%20political%20parties,well%20as%20its%20numerous%20predecessors).

18. Statista. (2021, March 9). Canada - resident population, by gender and age group 2020. https://www.statista.com/statistics/444858/canada-resident-population-by-gender-and-age-group/

19*. 


* = citation in R chunks in markdown