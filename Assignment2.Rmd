---
title: "Informative Title Name"
author: "GROUP NUMBER: ADD YOUR NAMES HERE"
date: May 28, 2021
subtitle: STA304 - Assignment 2
output:
  pdf_document: default
---

```{r, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
#library(openintro)
library(tidyverse)
library(broom)
```



```{r, include = FALSE}

# Here we are just loading the data files
census_data <- read_csv("gss_clean.csv")
# Here you can load in the survey data
survey_data <- read_csv("ces2019-phone_clean.csv")
```


## Introduction

<Here you should have a few paragraphs of text introducing the problem, getting the reader interested/ready for the rest of the report.>

<Introduce terminology.>

<Highlight hypotheses.>

<Optional: You can also include a description of each section of this report as a last paragraph.>


## Data

<Type here a paragraph introducing the data, its context and as much info about the data collection process that you know.>

<Type here a summary of the cleaning process (**only add in stuff beyond my original gss_cleaning.R code**). You only need to describe additional cleaning that you and your group did.> ]

#Data cleaning
```{r}
#filtering out the required columns
census_data.1 <- select(census_data, 2,5,11,12,16,17,19,21,23,24,27,28,30,38,44,47,49, 64)
#head(census_data.1)


# adding the place of birth to our data set
census_data.2 <- census_data.1 %>% mutate(place_birth = coalesce(place_birth_macro_region, place_birth_province ))

     #[https://stackoverflow.com/questions/14563531/combine-column-to-remove-nas]

# removing the columns for place of birth
census_data.3 <- select(census_data.2, -5,-6)
#view(census_data.3)


# remove the NA
census_data.4 <- na.omit(census_data.3)


# remove don't know from the selected columns
census_data.5 <- census_data.4[!grepl("Don't know", census_data.4$aboriginal), ]
census_data.5 <- census_data.5[!grepl("Don't know", census_data.5$vis_minority), ]
census_data.5 <- census_data.5[!grepl("Don't know", census_data.5$average_hours_worked), ]
census_data.5 <- census_data.5[!grepl("Don't know", census_data.5$regilion_importance), ]
census_data.5 <- census_data.5[!grepl("Don't know", census_data.5$average_hours_worked), ]
census_data.5 <- census_data.5[!grepl("Don't know", census_data.5$religion_participation), ]
```


#Syncing data variables with Census data so that we only have the variables avalible to us
```{r}
## EDUCATION

# combining the "Trade certificate or diploma" +"College, CEGEP or other non-university certificate or di..."
# into "College, CEGEP, trade certificate or other non-university certificate or di..."
  # reason: to sync with the survey data categoery
census_data.5$education <- replace(census_data.5$education, census_data.5$education ==
                                     "College, CEGEP or other non-university certificate or di...",
                                   "College, CEGEP, trade certificate or other non-university certificate or di...")
census_data.5$education <- replace(census_data.5$education, census_data.5$education ==
                                     "Trade certificate or diploma", "College, CEGEP, trade certificate or other non-university certificate or di...")


## Religion

# combining "At least 3 times a year" and "Once or twice a year" into "At least once a year"
census_data.5$religion_participation <- replace(census_data.5$religion_participation, census_data.5$religion_participation =="Once or twice a year", "At least once a year")
census_data.5$religion_participation <- replace(census_data.5$religion_participation, census_data.5$religion_participation =="At least 3 times a year", "At least once a year")


## Feelings life

## make a range for the values to fit with the other frame of 4 vlaues for feeling life
census_data.6 <- census_data.5 %>%
  # making a dummy col for now
  mutate(feelings_life_d = case_when(census_data.5$feelings_life < 2 ~ "Not satisfied at all",       # (0,1) not satisfied
                                   census_data.5$feelings_life <  6 ~ "Not very satisfied",        # [1,5] not very satisfied
                                   census_data.5$feelings_life <  10 ~ "Fairly satisfied",          # [6,9] failry satisfied
                                    census_data.5$feelings_life ==  10 ~ "Very satisfied"           # 10 satisfied
                                   ))

## now delete the original feeling col then rename the dummy col to the feeling col
census_data.7 <- select(census_data.6, -3)
names(census_data.7)[17] <- "feelings_life"



## Age

# we drop the decimal point to stay consistent with the survey

census_data.7$age <- floor(census_data.7$age)
          #https://stackoverflow.com/questions/40399255/remove-decimals-from-a-column-in-a-data-frame
```


#Dropping the columns in the census data which are not present in the survey data 
```{r}
census_data.8 <- census_data.7 %>%
  select(sex, province, feelings_life, education, religion_participation, age, income_family)

```



#Grouping based on proviences
```{r}
# make them in groups by province
alberta <- census_data.5 %>% group_by(province = "Alberta")
british_columbia <- census_data.5 %>% group_by(province = "British Columbia")
manitoba<- census_data.5 %>% group_by(province = "Manitoba")
new_brunswick<- census_data.5 %>% group_by(province = "New Brunswick")
newfoundland_labrador<- census_data.5 %>% group_by(province = "Newfoundland and Labrador")
nova_scotia<- census_data.5 %>% group_by(province = "Nova Scotia")
ontario <- census_data.5 %>% group_by(province = "Ontario")
prince_edward_island<- census_data.5 %>% group_by(province = "Prince Edward Island")
quebec<- census_data.5 %>% group_by(province = "Quebec")
saskatchewan<- census_data.5 %>% group_by(province = "Saskatchewan")


```



#Survey data set
```{r}
# get the required cols as the census data 
view(survey_data)


# filter them in groups
 
 # set the model 

# apply the model for each group


# get the results


# using the results predict for the census

```




#Data analysis


```{r}

```



```{r, include = FALSE}

#### You will need to update/clean the code below based off the variables you want to use in your post stratification.
view(sen) 
survey_data <- 
  survey_data %>% 
  mutate(age = 2019-q2,
         vote_liberal = ifelse(q11==1, 1, 0)) %>% 
  select(age, vote_liberal)

census_data <- census_data %>% 
  mutate(age=round(age)) %>% 
  select(age)

```


<Remember, you may want to use multiple datasets here, if you do end up using multiple data sets, or merging the data, be sure to describe this in the cleaning process and be sure to discuss important aspects of all the data that you used.>

<Include a description of the important variables.> 

```{r, include=FALSE}

# Use this to calculate some summary measures. 

```


<Include a description of the numerical summaries. Remember you can use `r ` to use inline R code.>

```{r, echo = TRUE}

# Use this to create some plots. Should probably describe both the sample and population.

```

<Include a clear description of the plot(s). I would recommend one paragraph for each plot.> 


## Methods

<Include some text introducing the methodology, maybe restating the problem/goal of this analysis.>


### Model Specifics
<Here you can describe your regression model>

<I will (incorrectly) be using a linear regression model to model the proportion of voters who will vote for Donald Trump. This is a naive model. I will only be using age, which is recorded as a numeric variable, to model the probability of voting for Donald Trump. The simple linear regression model I am using is:> 

$$ y = \beta_0+\beta_1  x_{age} + \epsilon$$

<Where $y$ represents the ....  $\beta_0$ represents....>

```{r, include=FALSE}

# Creating the Model
model <- lm(vote_liberal ~ age, data=survey_data)

# Model Results (to Report in Results section)
# summary(model)
# OR
# broom::tidy(model)

### Don't show the results/output here...

```


## Post-Stratification 

<Here you should explain the poststratification process>

<In order to estimate the proportion of voters.....>

<To put math/LaTeX inline just use one set of dollar signs. Example: $\hat{y}^{PS}$ >

<To put math on its own line use two sets of dollar signs:>

$$ include.your.mathematical.model.here.if.you.have.some.math.to.show $$


All analysis for this report was programmed using `R version 4.0.2`. 



## Results 

```{r, include=FALSE}

# Creating the Model
model <- lm(vote_liberal ~ age, data=survey_data)

# Model Results (to Report in Results section)
# summary(model)
# OR
# broom::tidy(model)
```

```{r, include=FALSE}

# Here I will perform the post-stratification calculation
census_data_counts <- census_data %>% 
  group_by(age) %>% 
  summarise(n=n())

census_data_counts$estimate <-
  model %>%
  predict(newdata = census_data_counts)

census_data_counts %>% 
  mutate(liberal_predict_prop = estimate*n) %>%
  summarise(liberal_predict = sum(liberal_predict_prop)/sum(n))

```

<Here you present your results. You may want to put them into a well formatted table. Be sure that there is some text describing the results.>


<Note: Alternatively you can use the `knitr::kable` function to create a well formatted table from your code. See here: [https://rmarkdown.rstudio.com/lesson-7.html](https://rmarkdown.rstudio.com/lesson-7.html).>



<Remember you can use `r ` to use inline R code.>


```{r, include = FALSE}

# Here you can include some relevant visualizations.


```

<Include an explanation/interpretation of the visualizations. Make sure to comment on the appropriateness of the assumptions/results.>

## Conclusions

## Drawbacks
                                                                      **relevant fields not found in the survey, provinces((11) Northwest Territories, (12) Yukon, (13) Nunavut)**

<Here you should give a summary of the Hypotheses, Methods and Results>

<Highlight Key Results.>

<Talk about big picture.>

<Comment on any Weaknesses.>

<Comment on Future Work/Next Steps>

<End with a concluding paragraph to wrap up the report.>


## Bibliography

1. Grolemund, G. (2014, July 16) *Introduction to R Markdown*. RStudio. [https://rmarkdown.rstudio.com/articles_intro.html](https://rmarkdown.rstudio.com/articles_intro.html). (Last Accessed: January 15, 2021) 

2. Dekking, F. M., et al. (2005) *A Modern Introduction to Probability and Statistics: Understanding why and how.* Springer Science & Business Media.

3.  Allaire, J.J., et. el. *References: Introduction to R Markdown*. RStudio. [https://rmarkdown.rstudio.com/docs/](https://rmarkdown.rstudio.com/docs/). (Last Accessed: January 15, 2021) 
