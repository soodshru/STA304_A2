---
title: 
author:
date: "May 28, 2021"
output:
  pdf_document:
    latex_engine: xelatex
subtitle: STA304 - Assignment 2
---

```{Latex}
\beta{\alpha}
```


```{r, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
#library(openintro)
library(tidyverse)
library(broom)
library(ggpubr)
library(lme4)
library(brms)
library(survey)
```

```{r, include = FALSE}
# Here we are just loading the data files
census_data <- read_csv("gss_clean.csv")
# Here you can load in the survey data
survey_data <- read_csv("ces2019_clean.csv")
```

# Introduction

## Problems
-Election results changing, identifying the right shift. The effects it has, [CAMBRIDGE ANALYTICA] russia, US ellection

##Basic Goal 
-To Identify and predict the next winner of the General Election
- How this Goal helps solve the problem
##Significance
<Here you should have a few paragraphs of text introducing the problem, getting the reader interested/ready for the rest of the report.>

<Introduce terminology.>

<Highlight hypotheses.>

<Optional: You can also include a description of each section of this report as a last paragraph.>

<Type here a paragraph introducing the data, its context and as much info about the data collection process that you know.>

<Type here a summary of the cleaning process (**only add in stuff beyond my original gss_cleaning.R code**). You only need to describe additional cleaning that you and your group did.> ]

#Data cleaning
```{r}
#filtering out the required columns
census_data.1 <- select(census_data, 2,12,16,17,19,28,47)
#head(census_data.1)

# adding the place of birth to our data set
census_data.2 <- census_data.1 %>% mutate(place_birth = coalesce(place_birth_macro_region, place_birth_province ))
#[https://stackoverflow.com/questions/14563531/combine-column-to-remove-nas]

# removing the columns for place of birth
census_data.3 <- select(census_data.2, -3,-4)
#view(census_data.3)

# remove the NA
census_data.4 <- na.omit(census_data.3)
```

#Syncing data variables with Census data so that we only have the variables avalible to us
```{r}
## EDUCATION

# combining the "Trade certificate or diploma" +"College, CEGEP or other non-university certificate or di..."
# into "College, CEGEP, trade certificate or other non-university certificate or di..."
  # reason: to sync with the survey data categoery
census_data.4$education <- replace(census_data.4$education, census_data.4$education ==
                                     "College, CEGEP or other non-university certificate or di...",
                                   "College, CEGEP, trade certificate or other non-university certificate or di...")
census_data.4$education <- replace(census_data.4$education, census_data.4$education ==
                                     "Trade certificate or diploma", "College, CEGEP, trade certificate or other non-university certificate or di...")

## Age

# we drop the decimal point to stay consistent with the survey

census_data.4$age <- floor(census_data.4$age)
#https://stackoverflow.com/questions/40399255/remove-decimals-from-a-column-in-a-data-frame
```

#Dropping the columns in the census data which are not present in the survey data 
```{r}
#census_data.8 <- census_data.7 %>%
 # select(sex, province, feelings_life, education, religion_participation, age, income_family)

```

## Data Analysis
```{r}

mytable.1 <- table(survey_data$sex)
lbls.1 <- paste(names(mytable.1), "\n", mytable.1, sep="")

mytable.2 <- table(census_data$sex)
lbls.2 <- paste(names(mytable.2), "\n", mytable.2, sep="")

# Pie Chart from data frame with Appended Sample Sizes                              [https://www.statmethods.net/graphs/pie.html]
# spreads of Sex, pie chart
#ggarrange(
  
#pie(mytable.1, labels = lbls.1,
  # main="Sex in Survey"),
#pie(mytable.2, labels = lbls.2,
  # main="Sex in Census"), ncol=2, nrow=1
#)

# Spreads of Sex
ggarrange(
ggplot(survey_data, aes(x=sex ))+
  geom_bar(color="darkblue", fill="lightblue", bins = 40) +
  ggtitle("Spread of Sex in Survey"),

ggplot(census_data.4, aes(x=sex))+
  geom_bar(color="darkblue", fill="lightblue", bins = 40) +
  ggtitle("Spread of Sex in Census"),
 ncol=2, nrow=1)

# Spread of Province                          ##----FIX THE LABLES-----##
ggarrange(
ggplot(survey_data, aes(x=province ))+
  geom_bar(color="darkblue", fill="lightblue", bins = 40) +
  ggtitle("Spread of Province in Survey"),

ggplot(census_data.4, aes(x=province))+
  geom_bar(color="darkblue", fill="lightblue", bins = 50) +
  ggtitle("Spread of Province in Census"),
 ncol=2, nrow=1)

# Spread of ages
ggarrange(
ggplot(survey_data, aes(x=age ))+
  geom_histogram(color="darkblue", fill="lightblue", bins = 40) +
  ggtitle("Spread of Ages in Survey"),

ggplot(census_data.4, aes(x=age))+
  geom_histogram(color="darkblue", fill="lightblue", bins = 50) +
  ggtitle("Spread of Ages in Census"),
 ncol=2, nrow=1)

# Spread of family income                      ----FIX AXIS or Pie Chart----
ggarrange(
ggplot(survey_data, aes(x=income_family ))+
  geom_bar(color="darkblue", fill="lightblue", bins = 40) +
  ggtitle("Spread of Family's incomes in Survey"),

ggplot(census_data.4, aes(x=income_family))+
  geom_bar(color="darkblue", fill="lightblue", bins = 50) +
  ggtitle("Spread of Family's incomes in Census"),
 ncol=2, nrow=1)

# get the frequency for each variable using 
table(census_data.4$province)
```

#Model ideas

## making the data sets to make models
```{r}

## make the according data sets according to the Support of their party               ---WITH AGE GROUPS
NDP_predic <- survey_data %>%
  mutate(NDP_pref = case_when(survey_data$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

## Bloc Québécois (BQ, PQ, Bloc, Parti Québécois)
Bloc_predic <- survey_data %>%
  mutate(Bloc_pref = case_when(survey_data$political_pref == "Bloc Québécois (BQ, PQ, Bloc, Parti Québécois)" ~ 1,
                              survey_data$political_pref != "Bloc Québécois (BQ, PQ, Bloc, Parti Québécois)" ~ 0))

## Green Party (Greens)
Green_predic <- survey_data %>%
  mutate(Green_pref = case_when(survey_data$political_pref == "Green Party (Greens)" ~ 1,
                              survey_data$political_pref != "Green Party (Greens)"  ~ 0))

## Conservatives (Tory, PCs, Conservative Party of Canada)
Conservative_predic <- survey_data %>%
  mutate(Conservative_pref = case_when(survey_data$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)"  ~ 0))

## Liberal (Grits)
Liberal_predic <- survey_data %>%
  mutate(Liberal_pref = case_when(survey_data$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data$political_pref != "Liberal (Grits)"  ~ 0))

## People's Party
Liberal_predic <- survey_data %>%
  mutate(People_pref = case_when(survey_data$political_pref == "People's Party" ~ 1,
                              survey_data$political_pref != "People's Party"  ~ 0))

## Will spoil ballet
Spoil_pred <- survey_data %>%
  mutate(People_pref = case_when(survey_data$political_pref == "Will spoil ballet" ~ 1,
                              survey_data$political_pref != "Will spoil ballet"  ~ 0))

## Other
Other_pred <- survey_data %>%
  mutate(Other_pref = case_when(survey_data$political_pref == "Other" ~ 1,
                              survey_data$political_pref != "Other"  ~ 0))
```


# grouping based on age for bin size
```{r}
#removing ppl less than 18 to match with                                ---Move to data cleaning--- **Limitation**
 census_data.44 <- subset(census_data.4, age >18)
  #census_data.4[census_data.4$age > 18, ]

# age group for census data                                                --- Model limitation for bins-----
census_data.5 <- census_data.44 %>%
 mutate(age_group = case_when(census_data.44$age <18 ~ "Under 18",
                              census_data.44$age <25 ~ "18 to 24 years",
                              census_data.44$age <45 ~ "25 to 44 years",
                              census_data.44$age <65 ~ "45 to 64 years",
                              census_data.44$age >64 ~ "Over 65",
                              ))
# dropping place of birth and their age                                   
census_data.6 <- select(census_data.5, -6, -1)


# survey data grouping based on age                                     ---Model Limitation----                             
survey_data.1 <- survey_data %>%
 mutate(age_group = case_when(survey_data$age <18 ~ "Under 18",
                              survey_data$age <25 ~ "18 to 24 years",
                              survey_data$age <45 ~ "25 to 44 years",
                              survey_data$age <65 ~ "45 to 64 years",
                              survey_data$age >64 ~ "Over 65",
                              ))

# removing feeling life, religion participation, age                     --- CHECK maybe a better model---
survey_data.2 <- select(survey_data.1, -3, -6)
survey_data.2 <- select(survey_data.2, -5)


# prob function                           --add this in the model---
est_p <- function(sum){
  return(exp(sum)/(1+(exp(sum))))
}



```


#Alberta 
##NDPxAlberta
```{r}
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the provience filter out Alberta ppl       --Filtering out the NDP survey data for the provience to make model
AlbertaXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Alberta",] 
# make the model for predicting the results on Alberta,              
glm_NDP_model.2<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=AlbertaXsurveyXNDP, family=binomial)
#results
summary(glm_NDP_model.2)

## assign bins and get the counts for the census data

# filter out for Alberta in the census data
albertaXcensus <- census_data.5[census_data.5$province =="Alberta",]
# get the bin count corresdonidng to the model we make
albertaXcensus.1 <- albertaXcensus %>%
  count(sex, education,  income_family, age_group)

# make the logg odds for the regression model
X <- predict(glm_NDP_model.2, albertaXcensus.1)
#view(X)
# appending the log odds to the  NDPxAlberta
albertaXcensus.1$NDP_odds <- X
# getting the probability for each group 
albertaXcensus.1 <- albertaXcensus.1 %>% mutate(prob_NDP = est_p(NDP_odds))

## post-strart for the albertaX_NDP

## sum of N                             --- add this in the model---
N <- sum(albertaXcensus.1$n)
# prediction for NDPxAlberta
NDP_Vote_percen_Alberta <- albertaXcensus.1 %>% summarise(NDP_est_Alberta = (sum(n*prob_NDP)/N))
NDP_Vote_percen_Alberta
```

##ConservativesXAlberta
```{r}
## Making the model and the predictions

# getting the NDP survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Alberta
# group the survey data by the provience filter out Alberta ppl       --Filtering out the NDP survey data for the provience to make model
AlbertaXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Alberta",] 
# make the model for predicting the results on Alberta,              
glm_Consv_model<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=AlbertaXsurveyXConsv, family=binomial)
#results
summary(glm_Consv_model)

## now assign bins and make the prdicitons
# filter out for Alberta in the census data
albertaXcensus <- census_data.5[census_data.5$province == "Alberta",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
albertaXcensus.1 <- albertaXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Consv_model, albertaXcensus.1)
#view(X)
# appending the log odds to the  NDPxAlberta
albertaXcensus.1$Consv_odds <- X
# getting the probability for each group 
albertaXcensus.1 <- albertaXcensus.1 %>% mutate(prob_Consv = est_p(Consv_odds))

## post-strart for the albertaX_Consv

## sum of N                             --- add this in the model---
N <- sum(albertaXcensus.1$n)
# prediction for NDPxAlberta
Consv_Vote_percen_Alberta <- albertaXcensus.1 %>% summarise(Consv_est_Alberta = (sum(n*prob_Consv)/N))
Consv_Vote_percen_Alberta
```

##LiberalXAlberta
```{r}
## Making the model and the predictions

# getting the NDP survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on Alberta
# group the survey data by the province filter out Alberta ppl       --Filtering out the NDP survey data for the province to make model
AlbertaXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Alberta",] 
# make the model for predicting the results on Alberta,              
glm_Lib_model<-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=AlbertaXsurveyXLib, family=binomial)
#results
summary(glm_Lib_model)

## now assign bins and make the prdicitons
# filter out for Alberta in the census data
albertaXcensus <- census_data.5[census_data.5$province == "Alberta",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
albertaXcensus.1 <- albertaXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Lib_model, albertaXcensus.1)
#view(X)
# appending the log odds to the  NDPxAlberta
albertaXcensus.1$Lib_odds <- X
# getting the probability for each group 
albertaXcensus.1 <- albertaXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-strart for the albertaX_Consv

## sum of N                             --- add this in the model---
N <- sum(albertaXcensus.1$n)
# prediction for NDPxAlberta
Lib_Vote_percen_Alberta <- albertaXcensus.1 %>% summarise(Lib_est_Alberta = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Alberta
```
BASED on the result we can see that Majority of the people in Alberta .... 


#British Columbia 
##NDPxBritish Columbia
```{r}
# getting the NDP survey data to make the models                            
NDP_predic.2 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the province filter out British Columbia ppl       --Filtering out the NDP survey data for the province to make model
BcXsurveyXNDP <- NDP_predic.2[NDP_predic.2$province == "British Columbia",]
# make the model for predicting the results on Alberta,              
glm_NDP_model.1<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=BcXsurveyXNDP, family=binomial)
#results
summary(glm_NDP_model.1)

## assign bins and get the counts for the census data

# filter out for British Columbia in the census data
BcXcensus <- census_data.5[census_data.5$province == "British Columbia",]
# get the bin count corresdonidng to the model we make
BcXcensus.1 <- albertaXcensus %>%
  count(sex, education,  income_family, age_group)

# make the logg odds for the regression model
X <- predict(glm_NDP_model.1, BcXcensus.1)
#view(X)
# appending the log odds to the  NDPxBritish Columbia
albertaXcensus.1$NDP_odds <- X
# getting the probability for each group 
albertaXcensus.1 <- albertaXcensus.1 %>% mutate(prob_NDP = est_p(NDP_odds))

## post-strart for the albertaX_NDP

## sum of N                             --- add this in the model---
N <- sum(BcXcensus.1$n)
# prediction for NDPxAlberta
NDP_Vote_percen_BC <- albertaXcensus.1 %>% summarise(NDP_est_BC = (sum(n*prob_NDP)/N))
NDP_Vote_percen_BC
```

##Conservatives x British Columbia
```{r}
# getting the NDP survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Alberta
# group the survey data by the provience filter out British Columbia ppl       --Filtering out the NDP survey data for the provience to make model
BcXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "British Columbia",] 
# make the model for predicting the results on British Columbia,              
glm_Consv_model_Bc<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=BcXsurveyXConsv, family=binomial)
#results
summary(glm_Consv_model_Bc)

## now assign bins and make the predicitons
# filter out for Alberta in the census data
BcXcensus <- census_data.5[census_data.5$province == "British Columbia",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
BcXcensus.1 <- BcXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Consv_model_Bc, BcXcensus.1)
#view(X)
# appending the log odds to the  NDPxBritish Columbia
BcXcensus.1$Consv_odds <- X
# getting the probability for each group 
BcXcensus.1 <- BcXcensus.1 %>% mutate(prob_Consv_Bc = est_p(Consv_odds))

## post-strart for the albertaX_Consv

## sum of N                             --- add this in the model---
N <- sum(BcXcensus.1$n)
# prediction for NDPxBritish Columbia
Consv_Vote_percen_Bc <- BcXcensus.1 %>% summarise(Consv_est_Bc = (sum(n*prob_Consv_Bc)/N))
Consv_Vote_percen_Bc
```

##LiberalXBc
```{r}
## Making the model and the predictions

# getting the NDP survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on BC
# group the survey data by the province filter out Bc ppl       --Filtering out the Liberal survey data for the province to make model
BcXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "British Columbia",]
# make the model for predicting the results on Alberta,              
glm_Lib_model_Bc <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=BcXsurveyXLib, family=binomial)
summary(glm_Lib_model_Bc)

## now assign bins and make the prdicitons
# filter out for Bc in the census data
BcXcensus <- census_data.5[census_data.5$province == "British Columbia",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
BcXcensus.1 <- BcXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Lib_model_Bc, BcXcensus.1)
#view(X)
# appending the log odds to the  NDPxBc
BcXcensus.1$Lib_odds <- X
# getting the probability for each group 
BcXcensus.1 <- BcXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-strart for the BcX_Consv

## sum of N                             --- add this in the model---
N <- sum(BcXcensus.1$n)
# prediction for NDPxBc
Lib_Vote_percen_Bc <- BcXcensus.1 %>% summarise(Lib_est_Bc = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Bc
```

#Ontario
##NDPxOntario
```{r}
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the provience filter out Ontario ppl       --Filtering out the NDP survey data for the provience to make model
OntarioXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Ontario",] 
# make the model for predicting the results on Ontario,              
glm_NDP_model.2<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=OntarioXsurveyXNDP, family=binomial)
#results
summary(glm_NDP_model.2)

## assign bins and get the counts for the census data

# filter out for Ontario in the census data
ontarioXcensus <- census_data.5[census_data.5$province =="Ontario",]
# get the bin count corresdonidng to the model we make
ontarioXcensus.1 <- ontarioXcensus %>%
  count(sex, education,  income_family, age_group)

# make the logg odds for the regression model
X <- predict(glm_NDP_model.2, ontarioXcensus.1)
#view(X)
# appending the log odds to the  NDPxOntario 
ontarioXcensus.1$NDP_odds <- X
# getting the probability for each group 
ontarioXcensus.1 <- ontarioXcensus.1 %>% mutate(prob_NDP_Ontario = est_p(NDP_odds))

## post-strart for the albertaX_NDP

## sum of N                             --- add this in the model---
N <- sum(ontarioXcensus.1$n)
# prediction for NDPxOntario
NDP_Vote_percen_Ontario <- ontarioXcensus.1 %>% summarise(NDP_est_Ontario = (sum(n*prob_NDP_Ontario)/N))
NDP_Vote_percen_Ontario
```

##Conservatives x Ontario
```{r}
# getting the NDP survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Ontario
# group the survey data by the provience filter out Ontario ppl       --Filtering out the NDP survey data for the provience to make model
OnXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Ontario",] 
# make the model for predicting the results on Ontario,              
glm_Consv_model_On<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=OnXsurveyXConsv, family=binomial)
#results
summary(glm_Consv_model_On)

## now assign bins and make the predicitons
# filter out for Ontario in the census data
OnXcensus <- census_data.5[census_data.5$province == "Ontario",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
OnXcensus.1 <- OnXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Consv_model_Bc, OnXcensus.1)
#view(X)
# appending the log odds to the  ConsxOntario
OnXcensus.1$Consv_odds <- X
# getting the probability for each group 
OnXcensus.1 <- OnXcensus.1 %>% mutate(prob_Consv_On = est_p(Consv_odds))

## post-strart for the OntarioX_Consv

## sum of N                             --- add this in the model---
N <- sum(OnXcensus.1$n)
# prediction for ConsxOntario
Cons_Vote_percen_Bc <- OnXcensus.1 %>% summarise(Consv_est_On = (sum(n*prob_Consv_On)/N))
Cons_Vote_percen_Bc
```

##Liberal X Ontario
```{r}
## Making the model and the predictions

# getting the NDP survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on Ontario
# group the survey data by the province filter out Bc ppl       --Filtering out the Liberal survey data for the province to make model
OnXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Ontario",]
# make the model for predicting the results on Ontario,              
glm_Lib_model_On <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=OnXsurveyXLib, family=binomial)
summary(glm_Lib_model_On)

## now assign bins and make the prdicitons
# filter out for Ontario in the census data
OnXcensus <- census_data.5[census_data.5$province == "Ontario",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
OnXcensus.1 <- OnXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Lib_model_Bc, OnXcensus.1)
#view(X)
# appending the log odds to the  NDPxOntario
OnXcensus.1$Lib_odds <- X
# getting the probability for each group 
OnXcensus.1 <- OnXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-strart for the OntarioX_Consv

## sum of N                             --- add this in the model---
N <- sum(OnXcensus.1$n)
# prediction for NDPxOntario
Lib_Vote_percen_On <- OnXcensus.1 %>% summarise(Lib_est_On = (sum(n*prob_Lib)/N))
Lib_Vote_percen_On
```

#Manitoba
##NDPxManitoba
```{r}
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the provience filter out Manitoba ppl       --Filtering out the NDP survey data for the provience to make model
MnXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Manitoba",] 
# make the model for predicting the results on Manitoba,              
glm_NDP_model.Mn<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=MnXsurveyXNDP, family=binomial)
#results
summary(glm_NDP_model.Mn)

## assign bins and get the counts for the census data

# filter out for Manitoba in the census data
MnXcensus <- census_data.5[census_data.5$province =="Manitoba",]
# get the bin count corresponding to the model we make
MnXcensus.1 <- MnXcensus %>%
  count(sex, education,  income_family, age_group)

# make the logg odds for the regression model
X <- predict(glm_NDP_model.Mn, MnXcensus.1)
#view(X)
# appending the log odds to the  NDPxManitoba 
MnXcensus.1$NDP_odds <- X
# getting the probability for each group
MnXcensus.1 <- MnXcensus.1 %>% mutate(prob_NDP_Manitoba = est_p(NDP_odds))

## post-strart for the ManitobaX_NDP

## sum of N                             --- add this in the model---
N <- sum(MnXcensus.1$n)
# prediction for NDPxManitoba
NDP_Vote_percen_Manitoba <- MnXcensus.1 %>% summarise(NDP_est_Manitoba = (sum(n*prob_NDP_Manitoba)/N))
NDP_Vote_percen_Manitoba
```

##Conservatives x Manitoba
```{r}
# getting the NDP survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Manitoba
# group the survey data by the provience filter out Manitoba ppl       --Filtering out the NDP survey data for the provience to make model
MnXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Manitoba",] 
# make the model for predicting the results on Manitoba,              
glm_Consv_model_Mn<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=MnXsurveyXConsv, family=binomial)
#results
summary(glm_Consv_model_Mn)

## now assign bins and make the predicitons
# filter out for Ontario in the census data
MnXcensus <- census_data.5[census_data.5$province == "Manitoba",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
MnXcensus.1 <- MnXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Consv_model_Bc, MnXcensus.1)
#view(X)
# appending the log odds to the  ConsxOntario
MnXcensus.1$Consv_odds <- X
# getting the probability for each group 
MnXcensus.1 <- MnXcensus.1 %>% mutate(prob_Consv_Mn = est_p(Consv_odds))

## post-strart for the OntarioX_Consv

## sum of N                             --- add this in the model---
N <- sum(MnXcensus.1$n)
# prediction for ConsxOntario
Cons_Vote_percen_Mn <- MnXcensus.1 %>% summarise(Consv_est_Mn = (sum(n*prob_Consv_Mn)/N))
Cons_Vote_percen_Mn
```

##Liberal X Manitoba
```{r}
## Making the model and the predictions

# getting the NDP survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on Manitoba
# group the survey data by the province filter out Manitoba ppl       --Filtering out the Liberal survey data for the province to make model
MnXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Manitoba",]
# make the model for predicting the results on Manitoba,              
glm_Lib_model_Mn <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=MnXsurveyXLib, family=binomial)
summary(glm_Lib_model_Mn)

## now assign bins and make the prdicitons
# filter out for Manitoba in the census data
MnXcensus <- census_data.5[census_data.5$province == "Manitoba",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
MnXcensus.1 <- MnXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Lib_model_Mn, MnXcensus.1)
#view(X)
# appending the log odds to the  NDPxManitoba
MnXcensus.1$Lib_odds <- X
# getting the probability for each group 
MnXcensus.1 <- MnXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-strart for the ManitobaX_Consv

## sum of N                             --- add this in the model---
N <- sum(MnXcensus.1$n)
# prediction for NDPxManitoba
Lib_Vote_percen_Mn <- MnXcensus.1 %>% summarise(Lib_est_Mn = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Mn
```

#Quebec                                     Limitation---No data on (Coalition Avenir Québec or the CAQ) and (Quebec Liberal Party) <- biggest parties in Quebec 
##Bloc Quebecois X Quebec
```{r}
## Making the model and the predictions

# getting the NDP survey data to make the models                            
Quebecois_predic <- survey_data.2 %>%
  mutate(Qb_pref = case_when(survey_data.2$political_pref == "Bloc Québécois (BQ, PQ, Bloc, Parti Québécois)" ~ 1,
                              survey_data.2$political_pref != "Bloc Québécois (BQ, PQ, Bloc, Parti Québécois)" ~ 0))

# filter out based on Quebec
# group the survey data by the province filter out Quebec ppl       --Filtering out the Liberal survey data for the province to make model
QuXsurveyXQb <- Quebecois_predic[Quebecois_predic$province == "Quebec",]
# make the model for predicting the results on Quebec,              
glm_Qb_model_Qb <-glmer(Qb_pref ~ sex + education + (1|income_family) + age_group, data=QuXsurveyXQb, family=binomial)
summary(glm_Qb_model_Qb)

## now assign bins and make the prdicitons
# filter out for Quebec in the census data
QbXcensus <- census_data.5[census_data.5$province == "Quebec",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
QbXcensus.1 <- QbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Qb_model_Qb, QbXcensus.1)
#view(X)
# appending the log odds to the  NDPxQuebec
QbXcensus.1$Qb_odds <- X
# getting the probability for each group 
QbXcensus.1 <- QbXcensus.1 %>% mutate(prob_Qb = est_p(Qb_odds))

## post-strart for the QuebecX_Qb

## sum of N                             --- add this in the model---
N <- sum(QbXcensus.1$n)
# prediction for NDPxManitoba
Qb_Vote_percen_Qb <- QbXcensus.1 %>% summarise(Qb_est_Qb = (sum(n*prob_Qb)/N))
Qb_Vote_percen_Qb
```

##Conservatives X Quebec
```{r}
# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Quebec
# group the survey data by the provience filter out Quebec ppl       --Filtering out the Conservative survey data for the provience to make model
QbXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Quebec",] 
# make the model for predicting the results on Quebec,              
glm_Consv_model_Qb<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=QbXsurveyXConsv, family=binomial)
#results
summary(glm_Consv_model_Qb)

## now assign bins and make the predicitons
# filter out for Ontario in the census data
QbXcensus <- census_data.5[census_data.5$province == "Quebec",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
QbXcensus.1 <- QbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Consv_model_Qb, QbXcensus.1)
#view(X)
# appending the log odds 
QbXcensus.1$Consv_odds <- X
# getting the probability for each group 
QbXcensus.1 <- QbXcensus.1 %>% mutate(prob_Consv_Qb = est_p(Consv_odds))

## post-strart for the QuebecX_Consv

## sum of N                             --- add this in the model---
N <- sum(QbXcensus.1$n)
# prediction for ConsxQuebec
Cons_Vote_percen_Qb <- QbXcensus.1 %>% summarise(Consv_est_Qb = (sum(n*prob_Consv_Qb)/N))
Cons_Vote_percen_Qb
```

##Liberal X Quebec
```{r}
## Making the model and the predictions

# getting the NDP survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on Quebec
# group the survey data by the province filter out Quebec ppl       --Filtering out the Liberal survey data for the province to make model
QbXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Quebec",]
# make the model for predicting the results on Quebec,              
glm_Lib_model_Qb <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=QbXsurveyXLib, family=binomial)
summary(glm_Lib_model_Qb)

## now assign bins and make the predictions
# filter out for Quebec in the census data
QbXcensus <- census_data.5[census_data.5$province == "Quebec",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
QbXcensus.1 <- QbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Lib_model_Qb, QbXcensus.1)
#view(X)
# appending the log odds to the  NDPxManitoba
QbXcensus.1$Lib_odds <- X
# getting the probability for each group 
QbXcensus.1 <- QbXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-strart for the Quebec_X_Liberal

## sum of N                             --- add this in the model---
N <- sum(QbXcensus.1$n)
# prediction for LiberalxQuebec
Lib_Vote_percen_Qb <- QbXcensus.1 %>% summarise(Lib_est_Qb = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Qb
```



#New Brunswick                        LIMITATION no one BW age 18-24 in survey
##New BrunswickXLiberal                   
```{r}
## Making the model and the predictions

# getting the NDP survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on New Brunswick
# group the survey data by the province filter out New Brunswick ppl       --Filtering out the Liberal survey data for the province to make model
NbXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "New Brunswick",]

# make the model for predicting the results on New Brunswick,              
glm_Lib_model_Nb <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=NbXsurveyXLib, family=binomial)
summary(glm_Lib_model_Nb)

## now assign bins and make the predictions
# filter out for New Brunswick in the census data
NbXcensus <- census_data.5[census_data.5$province == "New Brunswick",]    #### Can remove this line##
## removing the bin of ppl less than 18 because not in the survey bin
NbXcensus <- NbXcensus[NbXcensus$age_group != "18 to 24 years",]
# get the bin count corresdonidng to the model we make
NbXcensus.1 <- NbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Lib_model_Nb, NbXcensus.1)
#view(X)
# appending the log odds to the  NDPxManitoba
NbXcensus.1$Lib_odds <- X
# getting the probability for each group 
NbXcensus.1 <- NbXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-strart for the New Brunswick_X_Liberal

## sum of N                             --- add this in the model---
N <- sum(NbXcensus.1$n)
# prediction for LiberalxNb
Lib_Vote_percen_Nb <- NbXcensus.1 %>% summarise(Lib_est_Nb = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Nb
```

##New BrunswickXConservative
```{r}
# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on New Brunswick
# group the survey data by the provience filter out New Brunswick ppl       --Filtering out the Conservative survey data for the provience to make model
NbXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "New Brunswick",] 
# make the model for predicting the results on New Brunswick,              
glm_Consv_model_Nb<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=NbXsurveyXConsv, family=binomial)
#results
summary(glm_Consv_model_Nb)

## now assign bins and make the predicitons
# filter out for Ontario in the census data
NbXcensus <- census_data.5[census_data.5$province == "New Brunswick",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
## removing the bin of ppl less than 18 because not in the survey bin
NbXcensus <- NbXcensus[NbXcensus$age_group != "18 to 24 years",]
NbXcensus.1 <- NbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Consv_model_Nb, NbXcensus.1)
#view(X)
# appending the log odds 
NbXcensus.1$Consv_odds <- X
# getting the probability for each group 
NbXcensus.1 <- NbXcensus.1 %>% mutate(prob_Consv_Nb = est_p(Consv_odds))

## post-strart for the New BrunswickX_Consv

## sum of N                             --- add this in the model---
N <- sum(NbXcensus.1$n)
# prediction for ConsxNew Brunswick
Cons_Vote_percen_Nb <- NbXcensus.1 %>% summarise(Consv_est_Nb = (sum(n*prob_Consv_Nb)/N))
Cons_Vote_percen_Nb
```

##New BrunswickXGreen
```{r}
# getting the Conservative survey data to make the models                            
Green_predic.1 <- survey_data.2 %>%
  mutate(Green_pref = case_when(survey_data.2$political_pref == "Green Party (Greens)" ~ 1,
                              survey_data.2$political_pref != "Green Party (Greens)" ~ 0))

# filter out based on New Brunswick
# group the survey data by the provience filter out New Brunswick ppl       --Filtering out the Green survey data for the provience to make model
NbXsurveyXGreen <- Green_predic.1[Green_predic.1$province == "New Brunswick",] 
# make the model for predicting the results on New Brunswick,              
glm_Green_model_Nb<-glmer(Green_pref ~ sex + education + (1|income_family) + age_group, data=NbXsurveyXGreen, family=binomial)
#results
summary(glm_Green_model_Nb)

## now assign bins and make the predicitons
# filter out for New Brunsw in the census data
NbXcensus <- census_data.5[census_data.5$province == "New Brunswick",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
## removing the bin of ppl less than 18 because not in the survey bin
NbXcensus <- NbXcensus[NbXcensus$age_group != "18 to 24 years",]
NbXcensus.1 <- NbXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Green_model_Nb, NbXcensus.1)
#view(X)
# appending the log odds 
NbXcensus.1$Green_odds <- X
# getting the probability for each group 
NbXcensus.1 <- NbXcensus.1 %>% mutate(prob_Green_Nb = est_p(Green_odds))

## post-strart for the New BrunswickX_Consv

## sum of N                             --- add this in the model---
N <- sum(NbXcensus.1$n)
# prediction for ConsxNew Brunswick
Green_Vote_percen_Nb <- NbXcensus.1 %>% summarise(Green_est_Nb = (sum(n*prob_Green_Nb)/N))
Green_Vote_percen_Nb
```

#Saskatchewan
##Cons
```{r}
# getting the NDP survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Saskatchewan
# group the survey data by the provience filter out Saskatchewan ppl       --Filtering out the NDP survey data for the provience to make model
SaXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Saskatchewan",] 
# make the model for predicting the results on Saskatchewan,              
glm_Consv_model_Sa<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=SaXsurveyXConsv, family=binomial)
#results
summary(glm_Consv_model_Sa)

## now assign bins and make the predicitons
# filter out for Saskatchwan in the census data
SaXcensus <- census_data.5[census_data.5$province == "Saskatchewan",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
SaXcensus.1 <- SaXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Consv_model_Sa, SaXcensus.1)
#view(X)
# appending the log odds to the  NDPxSaskatchewan
SaXcensus.1$Consv_odds <- X
# getting the probability for each group 
SaXcensus.1 <- SaXcensus.1 %>% mutate(prob_Consv_Sa = est_p(Consv_odds))

## post-strart for the SaskatchewanX_Consv

## sum of N                             --- add this in the model---
N <- sum(SaXcensus.1$n)
# prediction for NDPxSaskatchewan
Consv_Vote_percen_Sa <- SaXcensus.1 %>% summarise(Consv_est_Sa = (sum(n*prob_Consv_Sa)/N))
Consv_Vote_percen_Sa
```
##Liberal
```{r}
## Making the model and the predictions

# getting the NDP survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on Saskatchewan
# group the survey data by the province filter out Saskatchewan ppl       --Filtering out the Liberal survey data for the province to make model
SaXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Saskatchewan",]
# make the model for predicting the results on Saskatchewan,              
glm_Lib_model_Sa <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=SaXsurveyXLib, family=binomial)
summary(glm_Lib_model_Sa)

## now assign bins and make the prdicitons
# filter out for Saskatchewan in the census data
SaXcensus <- census_data.5[census_data.5$province == "Saskatchewan",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
SaXcensus.1 <- SaXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Lib_model_Sa, SaXcensus.1)
#view(X)
# appending the log odds to the  NDPxSaskatchewan
SaXcensus.1$Lib_odds <- X
# getting the probability for each group 
SaXcensus.1 <- SaXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-strart for the SaskatchewanX_Consv

## sum of N                             --- add this in the model---
N <- sum(SaXcensus.1$n)
# prediction for NDPxSaskatchewan
Lib_Vote_percen_Sa <- SaXcensus.1 %>% summarise(Lib_est_Sa = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Sa
```
##NDP
```{r}
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the provience filter out Saskatchewan ppl       --Filtering out the NDP survey data for the provience to make model
SaXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Saskatchewan",] 
# make the model for predicting the results on Saskatchewan,              
glm_NDP_model.Sa<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=SaXsurveyXNDP, family=binomial)
#results
summary(glm_NDP_model.Sa)

## assign bins and get the counts for the census data

# filter out for Saskatchewan in the census data
SaXcensus <- census_data.5[census_data.5$province =="Saskatchewan",]
# get the bin count corresponding to the model we make
SaXcensus.1 <- SaXcensus %>%
  count(sex, education,  income_family, age_group)

# make the logg odds for the regression model
X <- predict(glm_NDP_model.Sa, SaXcensus.1)
#view(X)
# appending the log odds to the  NDPxSaskatchewan 
SaXcensus.1$NDP_odds <- X
# getting the probability for each group
SaXcensus.1 <- SaXcensus.1 %>% mutate(prob_NDP_Manitoba = est_p(NDP_odds))

## post-strart for the SaskatchewanX_NDP

## sum of N                             --- add this in the model---
N <- sum(SaXcensus.1$n)
# prediction for NDPxSaskatchewan
NDP_Vote_percen_Saskatchewan <- SaXcensus.1 %>% summarise(NDP_est_Saskatchewan = (sum(n*prob_NDP_Manitoba)/N))
NDP_Vote_percen_Saskatchewan
```


#Nova Scotia
##Cons
```{r}
# getting the NDP survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Nova Scotia
# group the survey data by the provience filter out Nova Scotia ppl       --Filtering out the NDP survey data for the provience to make model
NsXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Nova Scotia",] 
# make the model for predicting the results on Nova Scotia,              
glm_Consv_model_Ns<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=NsXsurveyXConsv, family=binomial)
#results
summary(glm_Consv_model_Ns)

## now assign bins and make the predicitons
# filter out for Nova Scotia in the census data
NsXcensus <- census_data.5[census_data.5$province == "Nova Scotia",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
NsXcensus.1 <- NsXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Consv_model_Ns, NsXcensus.1)
#view(X)
# appending the log odds to the  NDPxNova Scotia
NsXcensus.1$Consv_odds <- X
# getting the probability for each group 
NsXcensus.1 <- NsXcensus.1 %>% mutate(prob_Consv_Sa = est_p(Consv_odds))

## post-strart for the Nova ScotiaX_Consv

## sum of N                             --- add this in the model---
N <- sum(SaXcensus.1$n)
# prediction for NDPxNova Scotia
Consv_Vote_percen_Ns <- NsXcensus.1 %>% summarise(Consv_est_Ns = (sum(n*prob_Consv_Sa)/N))
Consv_Vote_percen_Ns
```
##Liberal
```{r}
## Making the model and the predictions

# getting the NDP survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on Nova Scotia
# group the survey data by the province filter out Nova Scotia ppl       --Filtering out the Liberal survey data for the province to make model
NsXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Nova Scotia",]
# make the model for predicting the results on Nova Scotia,              
glm_Lib_model_Ns <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=NsXsurveyXLib, family=binomial)
summary(glm_Lib_model_Ns)

## now assign bins and make the prdicitons
# filter out for Nova Scotia in the census data
NsXcensus <- census_data.5[census_data.5$province == "Nova Scotia",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
NsXcensus.1 <- NsXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Lib_model_Ns, NsXcensus.1)
#view(X)
# appending the log odds to the  LiberalxNova Scotia
NsXcensus.1$Lib_odds <- X
# getting the probability for each group 
NsXcensus.1 <- NsXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-strart for the Nova ScotiaX_Consv

## sum of N                             --- add this in the model---
N <- sum(NsXcensus.1$n)
# prediction for NDPxSaskatchewan
Lib_Vote_percen_Ns <- NsXcensus.1 %>% summarise(Lib_est_Ns = (sum(n*prob_Lib)/N))
Lib_Vote_percen_Ns
```
##NDP
```{r}
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the provience filter out Nova Scotia ppl       --Filtering out the NDP survey data for the provience to make model
NsXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Nova Scotia",] 
# make the model for predicting the results on Nova Scotia,              
glm_NDP_model.Ns<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=NsXsurveyXNDP, family=binomial)
#results
summary(glm_NDP_model.Ns)

## assign bins and get the counts for the census data

# filter out for Nova Scotia in the census data
NsXcensus <- census_data.5[census_data.5$province =="Nova Scotia",]
# get the bin count corresponding to the model we make
NsXcensus.1 <- NsXcensus %>%
  count(sex, education,  income_family, age_group)

# make the logg odds for the regression model
X <- predict(glm_NDP_model.Ns, NsXcensus.1)
#view(X)
# appending the log odds to the  NDPxNova Scotia
NsXcensus.1$NDP_odds <- X
# getting the probability for each group
NsXcensus.1 <- NsXcensus.1 %>% mutate(prob_NDP_Ns = est_p(NDP_odds))

## post-strart for the Nova ScotiaX_NDP

## sum of N                             --- add this in the model---
N <- sum(NsXcensus.1$n)
# prediction for NDPxNova Scotia
NDP_Vote_percen_Ns <- NsXcensus.1 %>% summarise(NDP_est_Ns = (sum(n*prob_NDP_Ns)/N))
NDP_Vote_percen_Ns
```


#Newfoundland and Labrador           ----AGE GROUP 18-24 limitation
##NDP
```{r}
# getting the NDP survey data to make the models                            
NDP_predic.1 <- survey_data.2 %>%
  mutate(NDP_pref = case_when(survey_data.2$political_pref == "NDP (New Democratic Party, New Democrats, NDPers)" ~ 1,
                              survey_data.2$political_pref != "NDP (New Democratic Party, New Democrats, NDPers)" ~ 0))

# group the survey data by the provience filter out Newfoundland and Labrador ppl       --Filtering out the NDP survey data for the provience to make model
NLXsurveyXNDP <- NDP_predic.1[NDP_predic.1$province == "Newfoundland and Labrador",] 
# make the model for predicting the results on Newfoundland and Labrador,              
glm_NDP_model.NL<-glmer(NDP_pref ~ sex + education + (1|income_family) + age_group, data=NLXsurveyXNDP, family=binomial)
#results
summary(glm_NDP_model.NL)

## assign bins and get the counts for the census data

# filter out for Newfoundland and Labrador in the census data
NLXcensus <- census_data.5[census_data.5$province =="Newfoundland and Labrador",]
## removing the bin of ppl less than 18 because not in the survey bin
NLXcensus <- NLXcensus[NLXcensus$age_group != "18 to 24 years",]
# get the bin count corresponding to the model we make
NLXcensus.1 <- NLXcensus %>%
  count(sex, education,  income_family, age_group)

# make the logg odds for the regression model
X <- predict(glm_NDP_model.NL, NLXcensus.1)
#view(X)
# appending the log odds to the  NDPxNewfoundland and Labrador
NLXcensus.1$NDP_odds <- X
# getting the probability for each group
NLXcensus.1 <- NLXcensus.1 %>% mutate(prob_NDP_NL = est_p(NDP_odds))

## post-strart for the Newfoundland and LabradorX_NDP

## sum of N                             --- add this in the model---
N <- sum(NLXcensus.1$n)
# prediction for NDPxNewfoundland and Labrador
NDP_Vote_percen_NL <- NLXcensus.1 %>% summarise(NDP_est_NL = (sum(n*prob_NDP_NL)/N))
NDP_Vote_percen_NL
```

##Liberal
```{r}
## Making the model and the predictions

# getting the Liberal survey data to make the models                            
Liberal_predic.1 <- survey_data.2 %>%
  mutate(Lib_pref = case_when(survey_data.2$political_pref == "Liberal (Grits)" ~ 1,
                              survey_data.2$political_pref != "Liberal (Grits))" ~ 0))

# filter out based on Newfoundland and Labrador
# group the survey data by the province filter out Newfoundland and Labrador ppl       --Filtering out the Liberal survey data for the province to make model
NLXsurveyXLib <- Liberal_predic.1[Liberal_predic.1$province == "Newfoundland and Labrador",]
# make the model for predicting the results on Newfoundland and Labrador,              
glm_Lib_model_NL <-glmer(Lib_pref ~ sex + education + (1|income_family) + age_group, data=NLXsurveyXLib, family=binomial)
summary(glm_Lib_model_NL)

## now assign bins and make the prdicitons
# filter out for Newfoundland and Labrador in the census data
NLXcensus <- census_data.5[census_data.5$province == "Newfoundland and Labrador",]    #### Can remove this line##
## removing the bin of ppl less than 18 because not in the survey bin
NLXcensus <- NLXcensus[NLXcensus$age_group != "18 to 24 years",]
# get the bin count corresdonidng to the model we make
NLXcensus.1 <- NLXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Lib_model_NL, NLXcensus.1)
#view(X)
# appending the log odds to the  LiberalxNewfoundland and Labrador
NLXcensus.1$Lib_odds <- X
# getting the probability for each group 
NLXcensus.1 <- NLXcensus.1 %>% mutate(prob_Lib = est_p(Lib_odds))

## post-strart for the Newfoundland and LabradorX_Consv

## sum of N                             --- add this in the model---
N <- sum(NsXcensus.1$n)
# prediction for NDPxNewfoundland and Labrador
Lib_Vote_percen_NL <- NLXcensus.1 %>% summarise(Lib_est_NL = (sum(n*prob_Lib)/N))
Lib_Vote_percen_NL
```

##Conservatives
```{r}
# getting the Conservative survey data to make the models                            
Conservatives_predic.1 <- survey_data.2 %>%
  mutate(Consv_pref = case_when(survey_data.2$political_pref == "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 1,
                              survey_data.2$political_pref != "Conservatives (Tory, PCs, Conservative Party of Canada)" ~ 0))

# filter out based on Newfoundland and Labrador
# group the survey data by the provience filter out Newfoundland and Labrador ppl       --Filtering out the Conservative survey data for the provience to make model
NLXsurveyXConsv <- Conservatives_predic.1[Conservatives_predic.1$province == "Newfoundland and Labrador",] 
# make the model for predicting the results on Newfoundland and Labrador,              
glm_Consv_model_NL<-glmer(Consv_pref ~ sex + education + (1|income_family) + age_group, data=NLXsurveyXConsv, family=binomial)
#results
summary(glm_Consv_model_NL)

## now assign bins and make the predicitons
# filter out for Newfoundland and Labrador in the census data
NLXcensus <- census_data.5[census_data.5$province == "Newfoundland and Labrador",]    #### Can remove this line##
# get the bin count corresdonidng to the model we make
## removing the bin of ppl less than 18 because not in the survey bin
NLXcensus <- NLXcensus[NLXcensus$age_group != "18 to 24 years",]
NLXcensus.1 <- NLXcensus %>%
  count(sex, education,  income_family, age_group)        #### Can remove this line##

# make the logg odds for the regression model
X <- predict(glm_Consv_model_NL, NLXcensus.1)
#view(X)
# appending the log odds 
NLXcensus.1$Consv_odds <- X
# getting the probability for each group 
NLXcensus.1 <- NLXcensus.1 %>% mutate(prob_Consv_NL = est_p(Consv_odds))

## post-strart for the Newfoundland and LabradorX_Consv

## sum of N                             --- add this in the model---
N <- sum(NLXcensus.1$n)
# prediction for ConsxNewfoundland and Labrador
Cons_Vote_percen_NL <- NLXcensus.1 %>% summarise(Consv_est_NL = (sum(n*prob_Consv_NL)/N))
# Cons_Vote_percen_NL
```
^Due to such a small percentage * n NaN = 0/N



#Grouping based on proviences
```{r}
# make them in groups by province
alberta <- census_data.4 %>% group_by(province = "Alberta")
british_columbia <- census_data.4 %>% group_by(province = "British Columbia")
manitoba<- census_data.5 %>% group_by(province = "Manitoba")
new_brunswick<- census_data.5 %>% group_by(province = "New Brunswick")
newfoundland_labrador<- census_data.5 %>% group_by(province = "Newfoundland and Labrador")
nova_scotia<- census_data.5 %>% group_by(province = "Nova Scotia")
ontario <- census_data.5 %>% group_by(province = "Ontario")
prince_edward_island<- census_data.5 %>% group_by(province = "Prince Edward Island")
quebec<- census_data.5 %>% group_by(province = "Quebec")
saskatchewan<- census_data.5 %>% group_by(province = "Saskatchewan")


```



```{r, include = FALSE}

#### You will need to update/clean the code below based off the variables you want to use in your post stratification.

```

<Remember, you may want to use multiple datasets here, if you do end up using multiple data sets, or merging the data, be sure to describe this in the cleaning process and be sure to discuss important aspects of all the data that you used.>

<Include a description of the important variables.> 

```{r, include=FALSE}

# Use this to calculate some summary measures. 

```

<Include a description of the numerical summaries. Remember you can use `r ` to use inline R code.>

```{r, echo = TRUE}

# Use this to create some plots. Should probably describe both the sample and population.

```

<Include a clear description of the plot(s). I would recommend one paragraph for each plot.> 

## Methods

<Include some text introducing the methodology, maybe restating the problem/goal of this analysis.>

### Model Specifics
<Here you can describe your regression model>

<I will (incorrectly) be using a linear regression model to model the proportion of voters who will vote for Donald Trump. This is a naive model. I will only be using age, which is recorded as a numeric variable, to model the probability of voting for Donald Trump. The simple linear regression model I am using is:> 

$$ y = \beta_0+\beta_1  x_{age} + \epsilon$$

<Where $y$ represents the ....  $\beta_0$ represents....>

```{r, include=FALSE}

# Creating the Model

# Model Results (to Report in Results section)
# summary(model)
# OR
# broom::tidy(model)

### Don't show the results/output here...

```

## Post-Stratification 

<Here you should explain the poststratification process>

<In order to estimate the proportion of voters.....>

<To put math/LaTeX inline just use one set of dollar signs. Example: $\hat{y}^{PS}$ >

<To put math on its own line use two sets of dollar signs:>

$$ include.your.mathematical.model.here.if.you.have.some.math.to.show $$
All analysis for this report was programmed using `R version 4.0.2`. 

## Results 

```{r, include=FALSE}

# Creating the Model

# Model Results (to Report in Results section)
# summary(model)
# OR
# broom::tidy(model)
```

```{r, include=FALSE}

```

<Here you present your results. You may want to put them into a well formatted table. Be sure that there is some text describing the results.>

<Note: Alternatively you can use the `knitr::kable` function to create a well formatted table from your code. See here: [https://rmarkdown.rstudio.com/lesson-7.html](https://rmarkdown.rstudio.com/lesson-7.html).>

<Remember you can use `r ` to use inline R code.>

```{r, include = FALSE}

# Here you can include some relevant visualizations.
```

<Include an explanation/interpretation of the visualizations. Make sure to comment on the appropriateness of the assumptions/results.>

## Conclusions

## Drawbacks
                                                                      **relevant fields not found in the survey, provinces((11) Northwest Territories, (12) Yukon, (13) Nunavut)**

<Here you should give a summary of the Hypotheses, Methods and Results>

<Highlight Key Results.>

<Talk about big picture.>

<Comment on any Weaknesses.>

<Comment on Future Work/Next Steps>

<End with a concluding paragraph to wrap up the report.>

## Bibliography

1. Grolemund, G. (2014, July 16) *Introduction to R Markdown*. RStudio. [https://rmarkdown.rstudio.com/articles_intro.html](https://rmarkdown.rstudio.com/articles_intro.html). (Last Accessed: January 15, 2021) 

2. Dekking, F. M., et al. (2005) *A Modern Introduction to Probability and Statistics: Understanding why and how.* Springer Science & Business Media.

3.  Allaire, J.J., et. el. *References: Introduction to R Markdown*. RStudio. [https://rmarkdown.rstudio.com/docs/](https://rmarkdown.rstudio.com/docs/). (Last Accessed: January 15, 2021) 
